{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"\ud83c\udf45 tomato - behavioral testing toolkit","text":"<p>[!WARNING] v2 is currently under active development. This version contains breaking changes and may not be stable.</p> <p>Looking for the stable version? v1 is available here, but will not receive future updates as development focuses on v2.</p> <p>Use v2 at your own risk - APIs and features may change without notice.</p> <p>Tomato is a language-agnostic behavioral testing framework that manages your test infrastructure automatically.</p>"},{"location":"#features","title":"Features","text":"<ul> <li>Built-in Container Orchestration - Automatically manage test containers with Testcontainers</li> <li>Clean State Testing - Reset resources between scenarios for reliable, isolated tests</li> <li>BDD/Gherkin Support - Write tests in plain English using Cucumber syntax</li> <li>Multiple Resource Types - HTTP, PostgreSQL, Redis, Kafka, WebSocket, Shell</li> <li>Auto-generated Documentation - Keep step docs in sync with code</li> <li>Application Runner - Start your app connected to test containers</li> </ul>"},{"location":"#installation","title":"Installation","text":""},{"location":"#quick-install-recommended","title":"Quick Install (recommended)","text":"<pre><code>curl -fsSL https://raw.githubusercontent.com/tomatool/tomato/main/install.sh | sh\n</code></pre>"},{"location":"#homebrew","title":"Homebrew","text":"<pre><code>brew install tomatool/tap/tomato\n</code></pre>"},{"location":"#github-actions","title":"GitHub Actions","text":"<pre><code>- uses: tomatool/tomato@v2\n</code></pre> <p>See GitHub Action documentation for all options.</p>"},{"location":"#go-install","title":"Go Install","text":"<pre><code>go install github.com/tomatool/tomato@latest\n</code></pre>"},{"location":"#from-source","title":"From Source","text":"<pre><code>git clone https://github.com/tomatool/tomato.git\ncd tomato\ngo build -o tomato .\nsudo mv tomato /usr/local/bin/\n</code></pre>"},{"location":"#quick-start","title":"Quick Start","text":"<pre><code>tomato init    # Initialize a new project\ntomato run     # Run behavioral tests\ntomato steps   # List available steps\n</code></pre>"},{"location":"#documentation","title":"Documentation","text":"<p>For complete documentation, visit tomatool.github.io/tomato</p> <ul> <li>Getting Started</li> <li>Configuration Reference</li> <li>Architecture</li> <li>Step Reference</li> </ul>"},{"location":"#license","title":"License","text":"<p>Tomato is open source under the MIT License.</p>"},{"location":"configuration/","title":"Configuration Reference","text":"<p>Complete reference for <code>tomato.yml</code> configuration options.</p>"},{"location":"configuration/#file-structure","title":"File Structure","text":"<pre><code>version: 2              # Required: config version\n\nsettings:               # Test execution settings\n  timeout: 5m\n  parallel: 1\n  fail_fast: false\n  output: pretty\n  reset:\n    level: scenario\n    on_failure: reset\n\napp:                    # Application under test (optional)\n  command: ./my-app\n  port: 8080\n  ready:\n    type: http\n    path: /health\n  wait: 5s\n  env:\n    KEY: value\n\ncontainers:             # Container definitions\n  name:\n    image: image:tag\n    env: {}\n    ports: []\n    volumes: []\n    depends_on: []\n    wait_for: {}\n    reset: {}\n\nresources:              # Resource/handler definitions\n  name:\n    type: http|http-server|postgres|redis|kafka|websocket|websocket-server|shell\n    container: container_name\n    options: {}\n\nhooks:                  # Lifecycle hooks\n  before_all: []\n  after_all: []\n  before_scenario: []\n  after_scenario: []\n\nfeatures:               # Feature file settings\n  paths:\n    - ./features\n  tags: \"\"\n</code></pre>"},{"location":"configuration/#settings","title":"Settings","text":"Field Type Default Description <code>timeout</code> duration <code>5m</code> Global test timeout <code>parallel</code> int <code>1</code> Number of parallel scenarios <code>fail_fast</code> bool <code>false</code> Stop on first failure <code>output</code> string <code>pretty</code> Output format: <code>pretty</code>, <code>progress</code>, <code>junit</code> <code>reset.level</code> string <code>scenario</code> Reset level: <code>scenario</code>, <code>feature</code>, <code>run</code>, <code>none</code> <code>reset.on_failure</code> string <code>reset</code> On failure: <code>reset</code>, <code>keep</code>"},{"location":"configuration/#app-configuration","title":"App Configuration","text":"<p>Configure your application under test to run with test containers.</p> <pre><code>app:\n  # Option 1: Run a command\n  command: go run ./cmd/server\n  workdir: ./\n\n  # Option 2: Build from Dockerfile\n  build:\n    dockerfile: Dockerfile\n    context: .\n\n  # Connection settings\n  port: 8080\n  ready:\n    type: http          # http, tcp, or exec\n    path: /health       # For HTTP checks\n    status: 200         # Expected status (default: 200)\n    timeout: 30s        # Ready check timeout\n\n  # Wait after ready check passes\n  wait: 5s\n\n  # Environment variables (supports container templates)\n  env:\n    DATABASE_URL: \"postgres://test:test@{{.postgres.host}}:{{.postgres.port}}/test\"\n    REDIS_URL: \"redis://{{.redis.host}}:{{.redis.port}}\"\n</code></pre>"},{"location":"configuration/#template-variables","title":"Template Variables","text":"<p>In <code>app.env</code>, you can use templates to inject container addresses:</p> Template Description <code>{{.container_name.host}}</code> Container hostname (e.g., <code>localhost</code> or Docker network IP) <code>{{.container_name.port}}</code> Container's mapped port (dynamically assigned) <p>Example with PostgreSQL: <pre><code>containers:\n  postgres:\n    image: postgres:15\n    env:\n      POSTGRES_USER: testuser\n      POSTGRES_PASSWORD: testpass\n      POSTGRES_DB: testdb\n    ports:\n      - \"5432\"\n\napp:\n  command: ./my-app\n  env:\n    # These are resolved at runtime when containers start\n    DB_HOST: \"{{.postgres.host}}\"\n    DB_PORT: \"{{.postgres.port}}\"\n    DATABASE_URL: \"postgres://testuser:testpass@{{.postgres.host}}:{{.postgres.port}}/testdb\"\n</code></pre></p> <p>Note: The <code>container</code> field in resource definitions automatically handles host/port resolution - you don't need to specify connection strings manually for resources.</p>"},{"location":"configuration/#containers","title":"Containers","text":"<p>Define Docker containers for your test infrastructure.</p> <pre><code>containers:\n  postgres:\n    image: postgres:15\n    env:\n      POSTGRES_USER: test\n      POSTGRES_PASSWORD: test\n      POSTGRES_DB: test\n    ports:\n      - \"5432\"\n    volumes:\n      - ./init.sql:/docker-entrypoint-initdb.d/init.sql\n    depends_on:\n      - other_container\n    wait_for:\n      type: port\n      target: \"5432\"\n      timeout: 30s\n    reset:\n      strategy: truncate\n      exclude:\n        - schema_migrations\n</code></pre>"},{"location":"configuration/#wait-strategies","title":"Wait Strategies","text":"Type Description Fields <code>port</code> Wait for port to be ready <code>target</code> <code>log</code> Wait for log message <code>target</code> (regex) <code>http</code> Wait for HTTP endpoint <code>method</code>, <code>path</code>, <code>port</code> <code>exec</code> Run command in container <code>target</code> (command)"},{"location":"configuration/#reset-strategies","title":"Reset Strategies","text":"Strategy Description <code>truncate</code> Truncate tables (Postgres) <code>flush</code> Flush database (Redis) <code>delete_recreate</code> Delete and recreate topics (Kafka) <code>none</code> No reset"},{"location":"configuration/#resources","title":"Resources","text":"<p>Define handlers for test steps.</p>"},{"location":"configuration/#http","title":"HTTP","text":"<pre><code>resources:\n  api:\n    type: http\n    base_url: http://localhost:8080\n    options:\n      timeout: 30s\n      headers:\n        Authorization: Bearer token\n</code></pre>"},{"location":"configuration/#postgresql","title":"PostgreSQL","text":"<pre><code>resources:\n  db:\n    type: postgres\n    container: postgres\n    database: test\n    options:\n      user: test\n      password: test\n      # Only truncate these tables during reset (if not set, truncates ALL public tables)\n      tables:\n        - users\n        - orders\n        - products\n      # Always exclude these tables from truncation\n      exclude:\n        - schema_migrations\n        - goose_db_version\n</code></pre>"},{"location":"configuration/#reset-behavior","title":"Reset Behavior","text":"<p>By default, PostgreSQL resources truncate all tables in the public schema before each scenario. You can control this behavior:</p> Option Description <code>tables</code> If set, only these tables are truncated (instead of all) <code>exclude</code> Tables to never truncate (default: <code>schema_migrations</code>, <code>goose_db_version</code>) <p>The <code>container</code> field automatically provides the connection details - tomato resolves the container's host and port at runtime.</p>"},{"location":"configuration/#redis","title":"Redis","text":"<pre><code>resources:\n  cache:\n    type: redis\n    container: redis\n    options:\n      db: 0\n      password: \"\"\n      reset_strategy: flush  # flush or pattern\n      reset_pattern: \"*\"     # For pattern strategy\n</code></pre>"},{"location":"configuration/#kafka","title":"Kafka","text":"<pre><code>resources:\n  kafka:\n    type: kafka\n    container: kafka\n    options:\n      topics:\n        - events\n        - notifications\n      partitions: 1\n      replication_factor: 1\n      reset_strategy: delete_recreate\n</code></pre>"},{"location":"configuration/#websocket","title":"WebSocket","text":"<pre><code>resources:\n  ws:\n    type: websocket\n    url: ws://localhost:8080/ws\n    # Or use container\n    container: app\n    options:\n      port: \"8080\"\n      path: /ws\n      protocols:\n        - graphql-ws\n      headers:\n        Authorization: Bearer token\n</code></pre>"},{"location":"configuration/#shell","title":"Shell","text":"<pre><code>resources:\n  shell:\n    type: shell\n    options:\n      timeout: 30s\n      workdir: ./scripts\n      env:\n        PATH: /usr/local/bin\n</code></pre>"},{"location":"configuration/#hooks","title":"Hooks","text":"<p>Execute actions at different lifecycle points.</p> <pre><code>hooks:\n  before_all:\n    - sql_file: ./fixtures/schema.sql\n      resource: db\n    - shell: ./scripts/setup.sh\n\n  after_all:\n    - shell: ./scripts/cleanup.sh\n\n  before_scenario:\n    - sql: \"DELETE FROM events\"\n      resource: db\n\n  after_scenario:\n    - exec: redis-cli FLUSHDB\n      container: redis\n</code></pre>"},{"location":"configuration/#hook-types","title":"Hook Types","text":"Type Description <code>sql</code> Execute SQL query <code>sql_file</code> Execute SQL file <code>shell</code> Run shell command <code>exec</code> Run command in container"},{"location":"configuration/#features","title":"Features","text":"<p>Configure feature file discovery.</p> <pre><code>features:\n  paths:\n    - ./features\n    - ./integration/features\n  tags: \"@smoke and not @slow\"\n</code></pre>"},{"location":"configuration/#tag-expressions","title":"Tag Expressions","text":"Expression Description <code>@smoke</code> Scenarios tagged with @smoke <code>@smoke and @api</code> Both tags <code>@smoke or @api</code> Either tag <code>not @slow</code> Exclude slow tests <code>@smoke and not @wip</code> Smoke tests, excluding WIP"},{"location":"configuration/#environment-variables","title":"Environment Variables","text":"<p>Use environment variables anywhere in the config:</p> <pre><code>containers:\n  postgres:\n    image: postgres:${POSTGRES_VERSION:-15}\n    env:\n      POSTGRES_PASSWORD: ${DB_PASSWORD}\n</code></pre>"},{"location":"configuration/http-server/","title":"HTTP Server Configuration","text":"<p>This guide covers how to configure the HTTP Server handler for mocking external services in integration tests.</p>"},{"location":"configuration/http-server/#overview","title":"Overview","text":"<p>The HTTP Server handler creates a local mock server that can stub HTTP endpoints. This is useful for testing how your application interacts with external APIs without actually calling them.</p>"},{"location":"configuration/http-server/#use-cases","title":"Use Cases","text":"<ul> <li>Mock third-party APIs (payment gateways, notification services, etc.)</li> <li>Simulate various response scenarios (success, errors, timeouts)</li> <li>Verify your application sends correct requests</li> <li>Test retry logic and error handling</li> </ul>"},{"location":"configuration/http-server/#resource-configuration","title":"Resource Configuration","text":"<p>The HTTP Server is a standalone handler that doesn't require a container:</p> <pre><code>resources:\n  mock:\n    type: http-server\n    options:\n      port: 9999\n</code></pre>"},{"location":"configuration/http-server/#resource-options","title":"Resource Options","text":"Option Type Default Description <code>port</code> int <code>0</code> (random) Port to listen on. Use <code>0</code> for system-assigned port, or specify a fixed port"},{"location":"configuration/http-server/#configuring-your-app-to-use-mock-servers","title":"Configuring Your App to Use Mock Servers","text":"<p>Since your application needs to call the mock server instead of the real external API, you must configure the mock server URLs via environment variables.</p> <p>Use the <code>{{.resource_name.url}}</code> template syntax to reference mock server URLs:</p> <pre><code>resources:\n  payment-api:\n    type: http-server\n    options:\n      port: 9001\n\n  notification-api:\n    type: http-server\n    options:\n      port: 9002\n\napp:\n  command: go run ./cmd/server\n  env:\n    # Use template syntax to reference mock server URLs\n    PAYMENT_API_URL: \"{{.payment-api.url}}\"\n    NOTIFICATION_API_URL: \"{{.notification-api.url}}\"\n</code></pre> <p>The templates resolve to: - Command mode: <code>http://localhost:{port}</code> (e.g., <code>http://localhost:9001</code>) - Container mode: <code>http://host.docker.internal:{port}</code> (accessible from Docker)</p> <p>Your application code should read these URLs from environment variables:</p> <pre><code>paymentAPIURL := os.Getenv(\"PAYMENT_API_URL\")\n// Use paymentAPIURL when making HTTP calls to payment service\n</code></pre> <p>Fixed Ports Required</p> <p>HTTP server resources must have a fixed <code>port</code> configured in options for the URL template to work. Without a port, the template cannot be resolved.</p>"},{"location":"configuration/http-server/#complete-example","title":"Complete Example","text":"<p>Here's a complete <code>tomato.yml</code> with multiple mock servers:</p> <pre><code>version: 2\n\nsettings:\n  timeout: 5m\n  fail_fast: false\n  output: pretty\n  reset:\n    level: scenario\n\nresources:\n  # Mock external payment gateway\n  payment-api:\n    type: http-server\n    options:\n      port: 9001\n\n  # Mock notification service\n  notification-api:\n    type: http-server\n    options:\n      port: 9002\n\n  # HTTP client to test your app\n  api:\n    type: http-client\n    base_url: \"http://localhost:8080\"\n\napp:\n  command: go run ./cmd/server\n  port: 8080\n  env:\n    # Templates resolve to http://localhost:9001, http://localhost:9002\n    PAYMENT_API_URL: \"{{.payment-api.url}}\"\n    NOTIFICATION_API_URL: \"{{.notification-api.url}}\"\n  ready:\n    type: http\n    path: /health\n    timeout: 30s\n\nfeatures:\n  paths:\n    - ./features\n</code></pre>"},{"location":"configuration/http-server/#writing-http-server-tests","title":"Writing HTTP Server Tests","text":""},{"location":"configuration/http-server/#basic-stubbing","title":"Basic Stubbing","text":"<pre><code>Feature: Payment Processing\n\n  Scenario: Process successful payment\n    # Stub the payment gateway\n    Given \"payment-api\" stub \"POST\" \"/charge\" returns \"200\" with json:\n      \"\"\"\n      {\"transaction_id\": \"txn_123\", \"status\": \"success\"}\n      \"\"\"\n    # Your app calls the payment gateway\n    When \"api\" sends \"POST\" to \"/process-payment\" with json:\n      \"\"\"\n      {\"amount\": 100, \"currency\": \"USD\"}\n      \"\"\"\n    Then \"api\" response status is \"200\"\n    And \"api\" response json \"status\" is \"completed\"\n</code></pre>"},{"location":"configuration/http-server/#stubbing-different-responses","title":"Stubbing Different Responses","text":"<pre><code>Scenario: Handle payment gateway error\n  Given \"payment-api\" stub \"POST\" \"/charge\" returns \"500\" with json:\n    \"\"\"\n    {\"error\": \"Gateway unavailable\"}\n    \"\"\"\n  When \"api\" sends \"POST\" to \"/process-payment\" with json:\n    \"\"\"\n    {\"amount\": 100}\n    \"\"\"\n  Then \"api\" response status is \"503\"\n</code></pre>"},{"location":"configuration/http-server/#custom-response-headers","title":"Custom Response Headers","text":"<pre><code>Scenario: API returns rate limit headers\n  Given \"payment-api\" stub \"GET\" \"/balance\" returns \"200\" with headers:\n    | header           | value |\n    | X-RateLimit-Remaining | 99    |\n    | X-RateLimit-Reset     | 3600  |\n  When \"api\" sends \"GET\" to \"/check-balance\"\n  Then \"api\" response status is \"200\"\n</code></pre>"},{"location":"configuration/http-server/#verifying-requests","title":"Verifying Requests","text":"<pre><code>Scenario: Verify authorization header is sent\n  Given \"payment-api\" stub \"POST\" \"/charge\" returns \"200\"\n  When \"api\" sends \"POST\" to \"/process-payment\" with json:\n    \"\"\"\n    {\"amount\": 50}\n    \"\"\"\n  Then \"payment-api\" received \"POST\" \"/charge\"\n  And \"payment-api\" received request with header \"Authorization\" containing \"Bearer\"\n\nScenario: Verify request body\n  Given \"payment-api\" stub \"POST\" \"/charge\" returns \"200\"\n  When \"api\" sends \"POST\" to \"/process-payment\" with json:\n    \"\"\"\n    {\"amount\": 75, \"currency\": \"EUR\"}\n    \"\"\"\n  Then \"payment-api\" received request with body containing \"EUR\"\n</code></pre>"},{"location":"configuration/http-server/#request-counting","title":"Request Counting","text":"<pre><code>Scenario: Verify retry behavior\n  # Stub fails first two times, succeeds third\n  Given \"payment-api\" stub \"POST\" \"/charge\" returns \"503\"\n  When \"api\" sends \"POST\" to \"/process-payment-with-retry\"\n  # App should have retried 3 times\n  Then \"payment-api\" received \"POST\" \"/charge\" \"3\" times\n</code></pre>"},{"location":"configuration/http-server/#negative-assertions","title":"Negative Assertions","text":"<pre><code>Scenario: Verify no unauthorized calls\n  Given \"payment-api\" stub \"GET\" \"/balance\" returns \"200\"\n  When \"api\" sends \"GET\" to \"/public-info\"\n  Then \"payment-api\" did not receive \"GET\" \"/balance\"\n</code></pre> <p>See HTTP Server Steps for the complete list of available steps.</p>"},{"location":"configuration/http-server/#multiple-mock-servers","title":"Multiple Mock Servers","text":"<p>You can configure multiple mock servers for different external services:</p> <pre><code>resources:\n  payment-api:\n    type: http-server\n    options:\n      port: 9001\n\n  notification-api:\n    type: http-server\n    options:\n      port: 9002\n\n  analytics-api:\n    type: http-server\n    options:\n      port: 9003\n</code></pre>"},{"location":"configuration/http-server/#reset-behavior","title":"Reset Behavior","text":"<p>Between each scenario: - All stubs are cleared - All recorded calls are cleared</p> <p>This ensures each scenario starts with a clean slate.</p>"},{"location":"configuration/http-server/#troubleshooting","title":"Troubleshooting","text":""},{"location":"configuration/http-server/#port-already-in-use","title":"Port Already in Use","text":"<p>If you get \"address already in use\" error:</p> <ol> <li>Use <code>port: 0</code> to let the system assign a free port</li> <li>Or kill processes using the specified port: <code>lsof -ti:9999 | xargs kill -9</code></li> </ol>"},{"location":"configuration/http-server/#requests-not-being-recorded","title":"Requests Not Being Recorded","text":"<ol> <li>Verify the URL in your test matches the stub path exactly</li> <li>Check that the HTTP method matches (GET vs POST)</li> <li>Ensure your application is pointing to the mock server's port</li> </ol>"},{"location":"configuration/http-server/#stub-not-matching","title":"Stub Not Matching","text":"<p>Stubs match in order they were defined. If a request doesn't match any stub, the server returns 404 with a message indicating no stub was found.</p>"},{"location":"configuration/kafka/","title":"Kafka Configuration","text":"<p>This guide covers how to configure Apache Kafka for integration testing with tomato.</p>"},{"location":"configuration/kafka/#overview","title":"Overview","text":"<p>Kafka integration testing with testcontainers requires special configuration due to how Kafka advertises its brokers to clients. This guide explains the recommended setup using Zookeeper-based Kafka with fixed port mapping.</p>"},{"location":"configuration/kafka/#the-challenge","title":"The Challenge","text":"<p>When running Kafka in a container with dynamic port mapping, clients connecting from the host machine need to know the actual mapped port. However, Kafka's advertised listeners are configured at startup time, before the dynamic port is assigned.</p> <p>The solution: Use fixed port mapping for the external listener and dual-listener configuration.</p>"},{"location":"configuration/kafka/#recommended-configuration","title":"Recommended Configuration","text":""},{"location":"configuration/kafka/#container-setup","title":"Container Setup","text":"<p>The recommended approach uses Zookeeper with Kafka and dual listeners:</p> <pre><code>containers:\n  zookeeper:\n    image: confluentinc/cp-zookeeper:7.6.1\n    env:\n      ZOOKEEPER_CLIENT_PORT: \"2181\"\n      ZOOKEEPER_TICK_TIME: \"2000\"\n    ports:\n      - \"2181/tcp\"\n    wait_for:\n      type: port\n      target: \"2181/tcp\"\n      timeout: 30s\n\n  kafka:\n    image: confluentinc/cp-kafka:7.6.1\n    depends_on:\n      - zookeeper\n    env:\n      KAFKA_BROKER_ID: \"1\"\n      KAFKA_ZOOKEEPER_CONNECT: \"{{.zookeeper.host}}:{{.zookeeper.port.2181}}\"\n      # Dual listeners: internal (kafka:29092) and external (localhost:9092)\n      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:29092,PLAINTEXT_HOST://localhost:9092\n      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT\n      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT\n      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: \"1\"\n      KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: \"0\"\n      KAFKA_AUTO_CREATE_TOPICS_ENABLE: \"true\"\n    ports:\n      # Fixed port for external access (host connects here)\n      - \"9092:9092\"\n      # Internal port for container-to-container (dynamic is fine)\n      - \"29092/tcp\"\n    wait_for:\n      type: port\n      target: \"9092/tcp\"\n      timeout: 60s\n</code></pre>"},{"location":"configuration/kafka/#key-configuration-explained","title":"Key Configuration Explained","text":""},{"location":"configuration/kafka/#dual-listeners","title":"Dual Listeners","text":"<p>Kafka is configured with two listeners:</p> Listener Address Purpose <code>PLAINTEXT</code> <code>kafka:29092</code> Internal communication between containers <code>PLAINTEXT_HOST</code> <code>localhost:9092</code> External access from host machine (tests)"},{"location":"configuration/kafka/#fixed-port-mapping","title":"Fixed Port Mapping","text":"<p>The external port uses fixed mapping (<code>9092:9092</code>) so the advertised listener (<code>localhost:9092</code>) matches the actual port:</p> <pre><code>ports:\n  - \"9092:9092\"    # Fixed: host:container\n  - \"29092/tcp\"    # Dynamic: just container port\n</code></pre>"},{"location":"configuration/kafka/#environment-variable-templates","title":"Environment Variable Templates","text":"<p>Tomato supports templates in container environment variables:</p> Template Resolves To <code>{{.container_name.host}}</code> Container's DNS name (for inter-container communication) <code>{{.container_name.port.XXXX}}</code> Container's internal port (not mapped host port) <p>For Zookeeper connection: <pre><code>KAFKA_ZOOKEEPER_CONNECT: \"{{.zookeeper.host}}:{{.zookeeper.port.2181}}\"\n</code></pre></p> <p>This resolves to <code>zookeeper:2181</code> (container DNS name + internal port).</p>"},{"location":"configuration/kafka/#resource-configuration","title":"Resource Configuration","text":"<p>Configure the Kafka resource to connect to the container:</p> <pre><code>resources:\n  events:\n    type: kafka\n    container: kafka\n    options:\n      topics:\n        - orders\n        - events\n        - notifications\n      partitions: 1\n      replication_factor: 1\n      reset_strategy: delete_recreate\n</code></pre>"},{"location":"configuration/kafka/#resource-options","title":"Resource Options","text":"Option Type Description <code>topics</code> list Topics to create/manage <code>partitions</code> int Number of partitions per topic (default: 1) <code>replication_factor</code> int Replication factor (default: 1) <code>reset_strategy</code> string How to reset between scenarios"},{"location":"configuration/kafka/#reset-strategies","title":"Reset Strategies","text":"Strategy Description <code>delete_recreate</code> Delete and recreate topics (recommended) <code>none</code> No reset between scenarios"},{"location":"configuration/kafka/#complete-example","title":"Complete Example","text":"<p>Here's a complete <code>tomato.yml</code> with Kafka:</p> <pre><code>version: 2\n\nsettings:\n  timeout: 5m\n  fail_fast: false\n  output: pretty\n  reset:\n    level: scenario\n\ncontainers:\n  zookeeper:\n    image: confluentinc/cp-zookeeper:7.6.1\n    env:\n      ZOOKEEPER_CLIENT_PORT: \"2181\"\n      ZOOKEEPER_TICK_TIME: \"2000\"\n    ports:\n      - \"2181/tcp\"\n    wait_for:\n      type: port\n      target: \"2181/tcp\"\n      timeout: 30s\n\n  kafka:\n    image: confluentinc/cp-kafka:7.6.1\n    depends_on:\n      - zookeeper\n    env:\n      KAFKA_BROKER_ID: \"1\"\n      KAFKA_ZOOKEEPER_CONNECT: \"{{.zookeeper.host}}:{{.zookeeper.port.2181}}\"\n      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:29092,PLAINTEXT_HOST://localhost:9092\n      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT\n      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT\n      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: \"1\"\n      KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: \"0\"\n      KAFKA_AUTO_CREATE_TOPICS_ENABLE: \"true\"\n    ports:\n      - \"9092:9092\"\n      - \"29092/tcp\"\n    wait_for:\n      type: port\n      target: \"9092/tcp\"\n      timeout: 60s\n\nresources:\n  events:\n    type: kafka\n    container: kafka\n    options:\n      topics:\n        - user-events\n        - order-events\n      partitions: 1\n      replication_factor: 1\n      reset_strategy: delete_recreate\n\nfeatures:\n  paths:\n    - ./features\n</code></pre>"},{"location":"configuration/kafka/#writing-kafka-tests","title":"Writing Kafka Tests","text":"<p>Once configured, you can write Gherkin scenarios to test Kafka:</p> <pre><code>Feature: Event Processing\n\n  Scenario: Order events are published correctly\n    Given \"events\" creates topic \"order-events\"\n    And \"events\" consumes from \"order-events\"\n    When \"events\" publishes json to \"order-events\" with key \"order-123\":\n      \"\"\"\n      {\"event\": \"order.created\", \"orderId\": \"123\", \"amount\": 99.99}\n      \"\"\"\n    Then \"events\" receives from \"order-events\" with key \"order-123\" within \"10s\"\n    And \"events\" last message contains:\n      \"\"\"\n      order.created\n      \"\"\"\n</code></pre> <p>See Kafka Steps for the complete list of available steps.</p>"},{"location":"configuration/kafka/#troubleshooting","title":"Troubleshooting","text":""},{"location":"configuration/kafka/#connection-refused","title":"Connection Refused","text":"<p>If tests fail with \"connection refused\":</p> <ol> <li>Verify Kafka container is healthy: <code>docker ps</code></li> <li>Check port 9092 is mapped: <code>docker port &lt;container_id&gt;</code></li> <li>Ensure no other process is using port 9092: <code>lsof -i :9092</code></li> </ol>"},{"location":"configuration/kafka/#consumer-not-receiving-messages","title":"Consumer Not Receiving Messages","text":"<ol> <li>Ensure <code>consumes from</code> is called before publishing</li> <li>The consumer starts at <code>OffsetNewest</code> - only messages published after consumer starts are received</li> <li>Verify topic exists with <code>topic \"name\" exists</code></li> </ol>"},{"location":"configuration/kafka/#port-already-in-use","title":"Port Already in Use","text":"<p>Since Kafka uses fixed port mapping (<code>9092:9092</code>), ensure no other Kafka instance is running:</p> <pre><code># Kill any process using port 9092\nlsof -ti:9092 | xargs kill -9\n</code></pre>"},{"location":"configuration/kafka/#alternative-kraft-mode-experimental","title":"Alternative: KRaft Mode (Experimental)","text":"<p>For newer Kafka versions, KRaft mode eliminates Zookeeper. However, the advertised listener challenge remains. If you want to try KRaft:</p> <pre><code>containers:\n  kafka:\n    image: confluentinc/cp-kafka:7.6.1\n    env:\n      KAFKA_NODE_ID: \"1\"\n      KAFKA_PROCESS_ROLES: broker,controller\n      KAFKA_LISTENERS: PLAINTEXT://kafka:29092,CONTROLLER://kafka:29093,PLAINTEXT_HOST://0.0.0.0:9092\n      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:29092,PLAINTEXT_HOST://localhost:9092\n      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT\n      KAFKA_CONTROLLER_QUORUM_VOTERS: 1@kafka:29093\n      KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER\n      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT\n      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: \"1\"\n      CLUSTER_ID: MkU3OEVBNTcwNTJENDM2Qk\n    ports:\n      - \"9092:9092\"\n      - \"29092/tcp\"\n</code></pre> <p>KRaft Compatibility</p> <p>KRaft mode may have compatibility issues with some Kafka client libraries. The Zookeeper-based setup is recommended for maximum compatibility.</p>"},{"location":"configuration/rabbitmq/","title":"RabbitMQ Configuration","text":"<p>This guide covers how to configure RabbitMQ for integration testing with tomato.</p>"},{"location":"configuration/rabbitmq/#overview","title":"Overview","text":"<p>RabbitMQ is a popular message broker that implements AMQP (Advanced Message Queuing Protocol). Unlike Kafka's topic-based model, RabbitMQ uses an exchange/queue/binding model for message routing.</p>"},{"location":"configuration/rabbitmq/#rabbitmq-concepts","title":"RabbitMQ Concepts","text":"Concept Description Queue A buffer that stores messages Exchange Routes messages to queues based on routing rules Binding A link between an exchange and a queue with an optional routing key Routing Key A message attribute used by exchanges to route messages"},{"location":"configuration/rabbitmq/#exchange-types","title":"Exchange Types","text":"Type Description <code>direct</code> Routes messages to queues with matching routing key <code>fanout</code> Broadcasts messages to all bound queues (ignores routing key) <code>topic</code> Routes messages based on routing key patterns (wildcards: <code>*</code> single word, <code>#</code> zero or more words) <code>headers</code> Routes based on message headers instead of routing key"},{"location":"configuration/rabbitmq/#container-setup","title":"Container Setup","text":"<p>Add a RabbitMQ container to your <code>tomato.yml</code>:</p> <pre><code>containers:\n  rabbitmq:\n    image: rabbitmq:3-alpine\n    ports:\n      - \"5672/tcp\"\n    env:\n      RABBITMQ_DEFAULT_USER: guest\n      RABBITMQ_DEFAULT_PASS: guest\n    wait_for:\n      type: port\n      target: \"5672\"\n      timeout: 30s\n</code></pre>"},{"location":"configuration/rabbitmq/#management-ui-optional","title":"Management UI (Optional)","text":"<p>For debugging, you can use the management image which includes a web UI:</p> <pre><code>containers:\n  rabbitmq:\n    image: rabbitmq:3-management-alpine\n    ports:\n      - \"5672/tcp\"\n      - \"15672/tcp\"  # Management UI\n    env:\n      RABBITMQ_DEFAULT_USER: guest\n      RABBITMQ_DEFAULT_PASS: guest\n    wait_for:\n      type: port\n      target: \"5672\"\n      timeout: 30s\n</code></pre> <p>Access the management UI at <code>http://localhost:&lt;mapped-port&gt;</code> with credentials <code>guest/guest</code>.</p>"},{"location":"configuration/rabbitmq/#resource-configuration","title":"Resource Configuration","text":"<p>Configure the RabbitMQ resource:</p> <pre><code>resources:\n  mq:\n    type: rabbitmq\n    container: rabbitmq\n    options:\n      user: guest\n      password: guest\n      vhost: /\n      reset_strategy: purge\n</code></pre>"},{"location":"configuration/rabbitmq/#resource-options","title":"Resource Options","text":"Option Type Default Description <code>user</code> string <code>guest</code> RabbitMQ username <code>password</code> string <code>guest</code> RabbitMQ password <code>vhost</code> string <code>/</code> Virtual host to connect to <code>reset_strategy</code> string <code>purge</code> How to reset between scenarios <code>queues</code> list - Pre-declare queues on init <code>exchanges</code> list - Pre-declare exchanges on init <code>bindings</code> list - Pre-declare bindings on init"},{"location":"configuration/rabbitmq/#reset-strategies","title":"Reset Strategies","text":"Strategy Description <code>purge</code> Purge messages from all declared queues (recommended, fastest) <code>delete_recreate</code> Delete and recreate all declared queues and exchanges <code>none</code> No reset between scenarios"},{"location":"configuration/rabbitmq/#pre-declaring-resources","title":"Pre-declaring Resources","text":"<p>You can pre-declare queues, exchanges, and bindings in the config:</p> <pre><code>resources:\n  mq:\n    type: rabbitmq\n    container: rabbitmq\n    options:\n      user: guest\n      password: guest\n      reset_strategy: purge\n      queues:\n        - name: orders\n          durable: true\n        - name: notifications\n          auto_delete: true\n      exchanges:\n        - name: events\n          type: topic\n          durable: true\n        - name: broadcast\n          type: fanout\n      bindings:\n        - queue: orders\n          exchange: events\n          routing_key: \"order.*\"\n        - queue: notifications\n          exchange: broadcast\n</code></pre>"},{"location":"configuration/rabbitmq/#complete-example","title":"Complete Example","text":"<p>Here's a complete <code>tomato.yml</code> with RabbitMQ:</p> <pre><code>version: 2\n\nsettings:\n  timeout: 5m\n  fail_fast: false\n  output: pretty\n  reset:\n    level: scenario\n\ncontainers:\n  rabbitmq:\n    image: rabbitmq:3-alpine\n    ports:\n      - \"5672/tcp\"\n    env:\n      RABBITMQ_DEFAULT_USER: guest\n      RABBITMQ_DEFAULT_PASS: guest\n    wait_for:\n      type: port\n      target: \"5672\"\n      timeout: 30s\n\nresources:\n  mq:\n    type: rabbitmq\n    container: rabbitmq\n    options:\n      user: guest\n      password: guest\n      reset_strategy: purge\n\nfeatures:\n  paths:\n    - ./features\n</code></pre>"},{"location":"configuration/rabbitmq/#writing-rabbitmq-tests","title":"Writing RabbitMQ Tests","text":""},{"location":"configuration/rabbitmq/#basic-queue-operations","title":"Basic Queue Operations","text":"<pre><code>Feature: Order Processing\n\n  Scenario: Orders are queued for processing\n    Given \"mq\" declares queue \"orders\"\n    And \"mq\" consumes from queue \"orders\"\n    When \"mq\" publishes json to queue \"orders\":\n      \"\"\"\n      {\"order_id\": \"123\", \"amount\": 99.99}\n      \"\"\"\n    Then \"mq\" receives from queue \"orders\" within \"5s\"\n    And \"mq\" last message contains:\n      \"\"\"\n      order_id\n      \"\"\"\n</code></pre>"},{"location":"configuration/rabbitmq/#topic-exchange-routing","title":"Topic Exchange Routing","text":"<pre><code>Scenario: Route orders by type\n  Given \"mq\" declares exchange \"orders\" of type \"topic\"\n  And \"mq\" declares queue \"domestic-orders\"\n  And \"mq\" declares queue \"international-orders\"\n  And \"mq\" binds queue \"domestic-orders\" to exchange \"orders\" with routing key \"order.domestic.*\"\n  And \"mq\" binds queue \"international-orders\" to exchange \"orders\" with routing key \"order.international.*\"\n  And \"mq\" consumes from queue \"domestic-orders\"\n  When \"mq\" publishes to exchange \"orders\" with routing key \"order.domestic.new\":\n    \"\"\"\n    New domestic order\n    \"\"\"\n  Then \"mq\" receives from queue \"domestic-orders\" within \"5s\":\n    \"\"\"\n    New domestic order\n    \"\"\"\n</code></pre>"},{"location":"configuration/rabbitmq/#fanout-exchange-broadcasting","title":"Fanout Exchange Broadcasting","text":"<pre><code>Scenario: Broadcast notifications to all subscribers\n  Given \"mq\" declares exchange \"notifications\" of type \"fanout\"\n  And \"mq\" declares queue \"email-service\"\n  And \"mq\" declares queue \"push-service\"\n  And \"mq\" declares queue \"sms-service\"\n  And \"mq\" binds queue \"email-service\" to exchange \"notifications\"\n  And \"mq\" binds queue \"push-service\" to exchange \"notifications\"\n  And \"mq\" binds queue \"sms-service\" to exchange \"notifications\"\n  And \"mq\" consumes from queue \"email-service\"\n  And \"mq\" consumes from queue \"push-service\"\n  When \"mq\" publishes to exchange \"notifications\" with routing key \"\":\n    \"\"\"\n    System maintenance in 1 hour\n    \"\"\"\n  Then \"mq\" receives from queue \"email-service\" within \"5s\":\n    \"\"\"\n    System maintenance in 1 hour\n    \"\"\"\n  And \"mq\" receives from queue \"push-service\" within \"5s\":\n    \"\"\"\n    System maintenance in 1 hour\n    \"\"\"\n</code></pre> <p>See RabbitMQ Steps for the complete list of available steps.</p>"},{"location":"configuration/rabbitmq/#troubleshooting","title":"Troubleshooting","text":""},{"location":"configuration/rabbitmq/#connection-refused","title":"Connection Refused","text":"<p>If tests fail with \"connection refused\":</p> <ol> <li>Verify RabbitMQ container is healthy: <code>docker ps</code></li> <li>Check the mapped port: <code>docker port &lt;container_id&gt;</code></li> <li>Ensure credentials match configuration</li> </ol>"},{"location":"configuration/rabbitmq/#consumer-not-receiving-messages","title":"Consumer Not Receiving Messages","text":"<ol> <li>Ensure <code>consumes from queue</code> is called before publishing</li> <li>Verify the queue exists and is bound to the correct exchange</li> <li>Check routing keys match the binding patterns</li> </ol>"},{"location":"configuration/rabbitmq/#messages-not-routing","title":"Messages Not Routing","text":"<p>For topic exchanges, verify your routing key patterns: - <code>*</code> matches exactly one word (e.g., <code>order.*</code> matches <code>order.created</code> but not <code>order.created.urgent</code>) - <code>#</code> matches zero or more words (e.g., <code>order.#</code> matches <code>order</code>, <code>order.created</code>, and <code>order.created.urgent</code>)</p>"},{"location":"configuration/rabbitmq/#queue-already-exists-with-different-properties","title":"Queue Already Exists with Different Properties","text":"<p>If you get \"PRECONDITION_FAILED\" errors: - Queues and exchanges are idempotent but properties must match - Either delete the queue manually or use <code>reset_strategy: delete_recreate</code></p>"},{"location":"configuration/redis/","title":"Redis Configuration","text":"<p>This guide covers how to configure Redis for integration testing with tomato.</p>"},{"location":"configuration/redis/#overview","title":"Overview","text":"<p>Redis is an in-memory data structure store used as a database, cache, and message broker. Tomato's Redis handler supports strings, hashes, lists, and sets.</p>"},{"location":"configuration/redis/#container-setup","title":"Container Setup","text":"<p>Add a Redis container to your <code>tomato.yml</code>:</p> <pre><code>containers:\n  redis:\n    image: redis:7-alpine\n    ports:\n      - \"6379/tcp\"\n    wait_for:\n      type: port\n      target: \"6379\"\n      timeout: 30s\n</code></pre>"},{"location":"configuration/redis/#with-password-authentication","title":"With Password Authentication","text":"<pre><code>containers:\n  redis:\n    image: redis:7-alpine\n    command: redis-server --requirepass mysecretpassword\n    ports:\n      - \"6379/tcp\"\n    wait_for:\n      type: port\n      target: \"6379\"\n      timeout: 30s\n</code></pre>"},{"location":"configuration/redis/#with-persistence-optional","title":"With Persistence (Optional)","text":"<p>For tests that need data persistence across container restarts:</p> <pre><code>containers:\n  redis:\n    image: redis:7-alpine\n    command: redis-server --appendonly yes\n    ports:\n      - \"6379/tcp\"\n    volumes:\n      - redis-data:/data\n    wait_for:\n      type: port\n      target: \"6379\"\n      timeout: 30s\n</code></pre>"},{"location":"configuration/redis/#resource-configuration","title":"Resource Configuration","text":"<p>Configure the Redis resource:</p> <pre><code>resources:\n  cache:\n    type: redis\n    container: redis\n    options:\n      db: 0\n      password: \"\"\n      reset_strategy: flush\n</code></pre>"},{"location":"configuration/redis/#resource-options","title":"Resource Options","text":"Option Type Default Description <code>db</code> int <code>0</code> Redis database number (0-15) <code>password</code> string <code>\"\"</code> Redis password (if authentication enabled) <code>reset_strategy</code> string <code>flush</code> How to reset between scenarios <code>reset_pattern</code> string <code>*</code> Pattern for selective key deletion (when using <code>pattern</code> strategy)"},{"location":"configuration/redis/#reset-strategies","title":"Reset Strategies","text":"Strategy Description <code>flush</code> Flush all keys in the database (recommended, fastest) <code>pattern</code> Delete keys matching <code>reset_pattern</code> (useful for shared databases)"},{"location":"configuration/redis/#complete-example","title":"Complete Example","text":"<p>Here's a complete <code>tomato.yml</code> with Redis:</p> <pre><code>version: 2\n\nsettings:\n  timeout: 5m\n  fail_fast: false\n  output: pretty\n  reset:\n    level: scenario\n\ncontainers:\n  redis:\n    image: redis:7-alpine\n    ports:\n      - \"6379/tcp\"\n    wait_for:\n      type: port\n      target: \"6379\"\n      timeout: 30s\n\nresources:\n  cache:\n    type: redis\n    container: redis\n    options:\n      db: 0\n      reset_strategy: flush\n\nfeatures:\n  paths:\n    - ./features\n</code></pre>"},{"location":"configuration/redis/#writing-redis-tests","title":"Writing Redis Tests","text":""},{"location":"configuration/redis/#string-operations","title":"String Operations","text":"<pre><code>Feature: Caching\n\n  Scenario: Cache user data\n    Given \"cache\" key \"user:123\" is \"John Doe\"\n    Then \"cache\" key \"user:123\" exists\n    And \"cache\" key \"user:123\" has value \"John Doe\"\n\n  Scenario: Cache with expiration\n    Given \"cache\" key \"session:abc\" is \"token123\" with TTL \"1h\"\n    Then \"cache\" key \"session:abc\" has TTL greater than \"3500\" seconds\n\n  Scenario: Store JSON data\n    Given \"cache\" key \"config\" is:\n      \"\"\"\n      {\"debug\": true, \"timeout\": 30}\n      \"\"\"\n    Then \"cache\" key \"config\" contains \"debug\"\n</code></pre>"},{"location":"configuration/redis/#hash-operations","title":"Hash Operations","text":"<pre><code>Scenario: Store user profile as hash\n  Given \"cache\" hash \"user:100\" has fields:\n    | field | value           |\n    | name  | Alice           |\n    | email | alice@test.com  |\n    | role  | admin           |\n  Then \"cache\" hash \"user:100\" field \"name\" is \"Alice\"\n  And \"cache\" hash \"user:100\" contains:\n    | field | value          |\n    | email | alice@test.com |\n</code></pre>"},{"location":"configuration/redis/#list-operations","title":"List Operations","text":"<pre><code>Scenario: Manage task queue\n  Given \"cache\" list \"tasks\" has values:\n    | process-order-1 |\n    | process-order-2 |\n    | send-email-3    |\n  Then \"cache\" list \"tasks\" has \"3\" items\n  And \"cache\" list \"tasks\" contains \"process-order-1\"\n</code></pre>"},{"location":"configuration/redis/#set-operations","title":"Set Operations","text":"<pre><code>Scenario: Track unique visitors\n  Given \"cache\" set \"visitors\" has members:\n    | user-1 |\n    | user-2 |\n    | user-3 |\n  Then \"cache\" set \"visitors\" has \"3\" members\n  And \"cache\" set \"visitors\" contains \"user-2\"\n</code></pre>"},{"location":"configuration/redis/#counter-operations","title":"Counter Operations","text":"<pre><code>Scenario: Track page views\n  Given \"cache\" key \"pageviews\" is \"100\"\n  When \"cache\" key \"pageviews\" is incremented\n  Then \"cache\" key \"pageviews\" has value \"101\"\n  When \"cache\" key \"pageviews\" is incremented by \"10\"\n  Then \"cache\" key \"pageviews\" has value \"111\"\n</code></pre> <p>See Redis Steps for the complete list of available steps.</p>"},{"location":"configuration/redis/#multiple-redis-databases","title":"Multiple Redis Databases","text":"<p>You can configure multiple Redis resources pointing to different databases:</p> <pre><code>resources:\n  cache:\n    type: redis\n    container: redis\n    options:\n      db: 0\n      reset_strategy: flush\n\n  sessions:\n    type: redis\n    container: redis\n    options:\n      db: 1\n      reset_strategy: flush\n</code></pre>"},{"location":"configuration/redis/#troubleshooting","title":"Troubleshooting","text":""},{"location":"configuration/redis/#connection-refused","title":"Connection Refused","text":"<p>If tests fail with \"connection refused\":</p> <ol> <li>Verify Redis container is running: <code>docker ps</code></li> <li>Check port mapping: <code>docker port &lt;container_id&gt;</code></li> <li>Ensure no firewall is blocking the connection</li> </ol>"},{"location":"configuration/redis/#authentication-failed","title":"Authentication Failed","text":"<p>If using password authentication:</p> <ol> <li>Verify password matches in container command and resource options</li> <li>Check for special characters that may need escaping</li> </ol>"},{"location":"configuration/redis/#keys-not-being-reset","title":"Keys Not Being Reset","text":"<p>If keys persist between scenarios:</p> <ol> <li>Verify <code>reset_strategy</code> is set (defaults to <code>flush</code>)</li> <li>If using <code>pattern</code> strategy, verify <code>reset_pattern</code> matches your keys</li> <li>Check that <code>settings.reset.level</code> is set to <code>scenario</code></li> </ol>"},{"location":"developer-guide/architecture/","title":"Architecture","text":"<p>This page provides an overview of tomato's internal architecture and how components interact during test execution.</p>"},{"location":"developer-guide/architecture/#high-level-overview","title":"High-Level Overview","text":"<p>tomato is designed around three core concepts:</p> <ol> <li>Containers - Docker containers managed via Testcontainers</li> <li>Resources - Abstractions over external services (databases, APIs, message queues)</li> <li>Handlers - Step definitions that interact with resources</li> </ol> <pre><code>flowchart TB\n    subgraph Config[\"tomato.yml\"]\n        C[Containers]\n        R[Resources]\n        F[Features]\n    end\n\n    subgraph Runtime[\"tomato Runtime\"]\n        TC[Testcontainers]\n        H[Handlers]\n        G[Gherkin Parser]\n    end\n\n    subgraph External[\"External Services\"]\n        DB[(PostgreSQL)]\n        REDIS[(Redis)]\n        KAFKA[(Kafka)]\n        HTTP[HTTP Server]\n        WS[WebSocket]\n    end\n\n    C --&gt; TC\n    R --&gt; H\n    F --&gt; G\n\n    TC --&gt; DB\n    TC --&gt; REDIS\n    TC --&gt; KAFKA\n\n    H --&gt; DB\n    H --&gt; REDIS\n    H --&gt; KAFKA\n    H --&gt; HTTP\n    H --&gt; WS\n\n    G --&gt; H</code></pre>"},{"location":"developer-guide/architecture/#test-execution-flow","title":"Test Execution Flow","text":"<p>When you run <code>tomato run</code>, the following sequence occurs:</p> <pre><code>sequenceDiagram\n    participant User\n    participant CLI\n    participant Config\n    participant TC as Testcontainers\n    participant App as Application\n    participant Handler\n    participant Godog\n\n    User-&gt;&gt;CLI: tomato run\n    CLI-&gt;&gt;Config: Parse tomato.yml\n\n    rect rgb(40, 40, 40)\n        Note over TC: Container Setup\n        Config-&gt;&gt;TC: Start containers\n        TC--&gt;&gt;TC: Wait for readiness\n        TC--&gt;&gt;Config: Container endpoints\n    end\n\n    rect rgb(40, 40, 40)\n        Note over App: App Setup (optional)\n        Config-&gt;&gt;App: Start application\n        App--&gt;&gt;App: Wait for ready check\n    end\n\n    rect rgb(40, 40, 40)\n        Note over Handler: Resource Setup\n        Config-&gt;&gt;Handler: Initialize handlers\n        Handler--&gt;&gt;Handler: Connect to services\n    end\n\n    rect rgb(40, 40, 40)\n        Note over Godog: Test Execution\n        CLI-&gt;&gt;Godog: Run features\n        loop Each Scenario\n            Godog-&gt;&gt;Handler: Reset resources\n            loop Each Step\n                Godog-&gt;&gt;Handler: Execute step\n                Handler--&gt;&gt;Godog: Result\n            end\n        end\n    end\n\n    Godog--&gt;&gt;CLI: Test results\n    CLI-&gt;&gt;TC: Stop containers\n    CLI-&gt;&gt;App: Stop application\n    CLI--&gt;&gt;User: Exit code</code></pre>"},{"location":"developer-guide/architecture/#handler-architecture","title":"Handler Architecture","text":"<p>Handlers are responsible for translating Gherkin steps into actions against resources:</p> <pre><code>flowchart LR\n    subgraph Steps[\"Gherkin Steps\"]\n        S1[\"Given I set 'db' table...\"]\n        S2[\"When I send 'GET' request...\"]\n        S3[\"Then response status is '200'\"]\n    end\n\n    subgraph Handlers[\"Handler Registry\"]\n        PG[PostgreSQL Handler]\n        HTTP[HTTP Client Handler]\n        REDIS[Redis Handler]\n        KAFKA[Kafka Handler]\n        WS[WebSocket Handler]\n        SHELL[Shell Handler]\n    end\n\n    subgraph Resources[\"Resources\"]\n        DB[(Database)]\n        API[HTTP API]\n        CACHE[(Cache)]\n        MQ[(Message Queue)]\n        WSS[WebSocket Server]\n        CMD[Shell]\n    end\n\n    S1 --&gt; PG\n    S2 --&gt; HTTP\n    S3 --&gt; HTTP\n\n    PG --&gt; DB\n    HTTP --&gt; API\n    REDIS --&gt; CACHE\n    KAFKA --&gt; MQ\n    WS --&gt; WSS\n    SHELL --&gt; CMD</code></pre>"},{"location":"developer-guide/architecture/#resource-lifecycle","title":"Resource Lifecycle","text":"<p>Each resource follows a consistent lifecycle:</p> <pre><code>stateDiagram-v2\n    [*] --&gt; Configured: Parse config\n    Configured --&gt; Initialized: Initialize handler\n    Initialized --&gt; Connected: Connect to service\n    Connected --&gt; Ready: Ready for tests\n\n    Ready --&gt; Reset: Before scenario\n    Reset --&gt; Ready: Clean state\n\n    Ready --&gt; Closed: Tests complete\n    Closed --&gt; [*]</code></pre>"},{"location":"developer-guide/architecture/#container-orchestration","title":"Container Orchestration","text":"<p>tomato uses Testcontainers to manage Docker containers:</p> <pre><code>flowchart TB\n    subgraph Config[\"Configuration\"]\n        YAML[\"tomato.yml\"]\n    end\n\n    subgraph Testcontainers[\"Testcontainers Runtime\"]\n        CM[Container Manager]\n        NW[Network]\n\n        subgraph Containers\n            C1[postgres:15]\n            C2[redis:7]\n            C3[kafka:latest]\n        end\n    end\n\n    subgraph WaitStrategies[\"Wait Strategies\"]\n        PORT[Port Check]\n        HTTP_CHECK[HTTP Check]\n        LOG[Log Pattern]\n    end\n\n    YAML --&gt; CM\n    CM --&gt; NW\n    CM --&gt; C1\n    CM --&gt; C2\n    CM --&gt; C3\n\n    C1 --&gt; PORT\n    C2 --&gt; PORT\n    C3 --&gt; LOG</code></pre>"},{"location":"developer-guide/architecture/#data-flow-example","title":"Data Flow Example","text":"<p>Here's how a typical database test scenario flows through the system:</p> <pre><code>sequenceDiagram\n    participant Feature as Feature File\n    participant Godog\n    participant PG as PostgreSQL Handler\n    participant DB as PostgreSQL\n\n    Note over Feature: Scenario: Create user\n\n    Feature-&gt;&gt;Godog: Given I set \"db\" table \"users\"...\n    Godog-&gt;&gt;PG: SetTableValues(table, data)\n    PG-&gt;&gt;DB: INSERT INTO users...\n    DB--&gt;&gt;PG: OK\n    PG--&gt;&gt;Godog: Success\n\n    Feature-&gt;&gt;Godog: When I execute on \"db\" query...\n    Godog-&gt;&gt;PG: ExecuteQuery(query)\n    PG-&gt;&gt;DB: SELECT * FROM users\n    DB--&gt;&gt;PG: Results\n    PG--&gt;&gt;Godog: Store results\n\n    Feature-&gt;&gt;Godog: Then \"db\" query result should be...\n    Godog-&gt;&gt;PG: AssertQueryResult(expected)\n    PG--&gt;&gt;Godog: Match/No match</code></pre>"},{"location":"developer-guide/architecture/#http-requestresponse-flow","title":"HTTP Request/Response Flow","text":"<pre><code>sequenceDiagram\n    participant Feature as Feature File\n    participant HTTP as HTTP Handler\n    participant API as Target API\n\n    Feature-&gt;&gt;HTTP: Given I set request header...\n    HTTP--&gt;&gt;HTTP: Store header\n\n    Feature-&gt;&gt;HTTP: When I send \"POST\" to \"/users\"\n    HTTP-&gt;&gt;API: POST /users\n    API--&gt;&gt;HTTP: 201 Created + JSON body\n    HTTP--&gt;&gt;HTTP: Store response\n\n    Feature-&gt;&gt;HTTP: Then response status is \"201\"\n    HTTP--&gt;&gt;HTTP: Assert status\n\n    Feature-&gt;&gt;HTTP: And response JSON \"id\" exists\n    HTTP--&gt;&gt;HTTP: Assert JSON path</code></pre>"},{"location":"developer-guide/architecture/#configuration-structure","title":"Configuration Structure","text":"<pre><code>flowchart TB\n    subgraph tomato.yml\n        direction TB\n        V[version: 2]\n\n        subgraph containers\n            C1[name: postgres&lt;br/&gt;image: postgres:15&lt;br/&gt;env: ...&lt;br/&gt;wait_for: ...]\n            C2[name: redis&lt;br/&gt;image: redis:7]\n        end\n\n        subgraph resources\n            R1[name: db&lt;br/&gt;type: postgres&lt;br/&gt;container: postgres]\n            R2[name: cache&lt;br/&gt;type: redis&lt;br/&gt;container: redis]\n            R3[name: api&lt;br/&gt;type: http&lt;br/&gt;base_url: ...]\n        end\n\n        subgraph app\n            A[command: go run ./cmd/server&lt;br/&gt;port: 8080&lt;br/&gt;ready: http /health&lt;br/&gt;env: ...]\n        end\n\n        subgraph features\n            F[paths:&lt;br/&gt;  - ./features]\n        end\n    end</code></pre>"},{"location":"developer-guide/architecture/#error-handling","title":"Error Handling","text":"<p>When a step fails, tomato provides detailed error information:</p> <pre><code>flowchart TB\n    Step[Step Execution] --&gt; Check{Success?}\n    Check --&gt;|Yes| Next[Next Step]\n    Check --&gt;|No| Error[Error Details]\n\n    Error --&gt; Type{Error Type}\n    Type --&gt;|Connection| Conn[Connection failed to resource]\n    Type --&gt;|Assertion| Assert[Expected vs Actual mismatch]\n    Type --&gt;|Timeout| Timeout[Operation timed out]\n    Type --&gt;|Syntax| Syntax[Invalid step syntax]\n\n    Conn --&gt; Report[Report to User]\n    Assert --&gt; Report\n    Timeout --&gt; Report\n    Syntax --&gt; Report\n\n    Report --&gt; Cleanup[Cleanup Resources]\n    Cleanup --&gt; Exit[Exit with error code]</code></pre>"},{"location":"getting-started/","title":"Getting Started","text":"<p>This guide will help you set up Tomato and run your first behavioral test.</p>"},{"location":"getting-started/#prerequisites","title":"Prerequisites","text":"<ul> <li>Go 1.24+ (for installation)</li> <li>Docker (for running containers)</li> </ul>"},{"location":"getting-started/#installation","title":"Installation","text":""},{"location":"getting-started/#quick-install-recommended","title":"Quick Install (Recommended)","text":"<pre><code>curl -fsSL https://raw.githubusercontent.com/tomatool/tomato/main/install.sh | sh\n</code></pre>"},{"location":"getting-started/#using-go","title":"Using Go","text":"<pre><code>go install github.com/tomatool/tomato@latest\n</code></pre>"},{"location":"getting-started/#using-homebrew","title":"Using Homebrew","text":"<pre><code>brew install tomatool/tap/tomato\n</code></pre>"},{"location":"getting-started/#verify-installation","title":"Verify Installation","text":"<pre><code>tomato --version\n</code></pre>"},{"location":"getting-started/#initialize-a-project","title":"Initialize a Project","text":"<p>Create a new project with the init command:</p> <pre><code>mkdir my-project &amp;&amp; cd my-project\ntomato init\n</code></pre> <p>This creates: - <code>tomato.yml</code> - Main configuration file - <code>features/</code> - Directory for your feature files</p>"},{"location":"getting-started/#project-structure","title":"Project Structure","text":"<pre><code>my-project/\n\u251c\u2500\u2500 tomato.yml           # Main configuration\n\u251c\u2500\u2500 features/\n\u2502   \u2514\u2500\u2500 example.feature  # Gherkin test files\n\u2514\u2500\u2500 fixtures/            # Optional: SQL scripts, test data\n</code></pre>"},{"location":"getting-started/#configuration","title":"Configuration","text":"<p>Edit <code>tomato.yml</code> to define your test environment:</p> <pre><code>version: 2\n\n# Test settings\nsettings:\n  timeout: 5m\n  fail_fast: true\n  reset:\n    level: scenario  # Reset resources between scenarios\n\n# Define containers to run\ncontainers:\n  postgres:\n    image: postgres:15\n    env:\n      POSTGRES_USER: test\n      POSTGRES_PASSWORD: test\n      POSTGRES_DB: test\n    wait_for:\n      type: port\n      target: \"5432\"\n\n  redis:\n    image: redis:7\n    wait_for:\n      type: port\n      target: \"6379\"\n\n# Define resources (handlers) for your tests\nresources:\n  db:\n    type: postgres\n    container: postgres\n    database: test\n\n  cache:\n    type: redis\n    container: redis\n\n  api:\n    type: http\n    base_url: http://localhost:8080\n\n# Feature file locations\nfeatures:\n  paths:\n    - ./features\n  tags: \"@smoke\"  # Optional: filter by tags\n</code></pre>"},{"location":"getting-started/#writing-tests","title":"Writing Tests","text":"<p>Create a feature file in <code>features/</code>:</p> <pre><code># features/user_api.feature\nFeature: User API\n\n  Background:\n    Given I set \"db\" table \"users\" with values:\n      | id | name  | email          |\n      | 1  | Alice | alice@test.com |\n\n  Scenario: Get user by ID\n    When I send \"GET\" request to \"api\" \"/users/1\"\n    Then \"api\" response status should be \"200\"\n    And \"api\" response JSON \"name\" should be \"Alice\"\n\n  Scenario: Create new user\n    When I set \"api\" JSON body:\n      \"\"\"\n      {\"name\": \"Bob\", \"email\": \"bob@test.com\"}\n      \"\"\"\n    And I send \"POST\" request to \"api\" \"/users\"\n    Then \"api\" response status should be \"201\"\n    And \"db\" table \"users\" should have \"2\" rows\n</code></pre>"},{"location":"getting-started/#validate-configuration","title":"Validate Configuration","text":"<p>Before running tests, validate your configuration and feature files:</p> <pre><code>tomato validate\n</code></pre> <p>This checks: - Configuration file syntax and structure - Resource type validity - Container references - Feature file parsing - Step definitions availability</p> <p>Use <code>--plain</code> for CI environments without interactive output:</p> <pre><code>tomato validate --plain\n</code></pre>"},{"location":"getting-started/#running-tests","title":"Running Tests","text":"<p>Run all tests:</p> <pre><code>tomato run\n</code></pre> <p>Run with specific tags:</p> <pre><code>tomato run --tags \"@smoke\"\n</code></pre> <p>Run with verbose output:</p> <pre><code>tomato run -v\n</code></pre>"},{"location":"getting-started/#testing-your-application","title":"Testing Your Application","text":"<p>Tomato can also start your application and connect it to test containers:</p> <pre><code># tomato.yml\napp:\n  command: go run ./cmd/server\n  port: 8080\n  ready:\n    type: http\n    path: /health\n  wait: 5s\n  env:\n    DATABASE_URL: \"postgres://test:test@{{.postgres.host}}:{{.postgres.port}}/test\"\n    REDIS_URL: \"redis://{{.redis.host}}:{{.redis.port}}\"\n</code></pre> <p>The <code>{{.container.host}}</code> and <code>{{.container.port}}</code> templates are replaced with actual container addresses.</p>"},{"location":"getting-started/#next-steps","title":"Next Steps","text":"<ul> <li>Configuration Reference - Full configuration options</li> <li>Resources - All available step definitions</li> <li>Examples - Sample projects</li> </ul>"},{"location":"getting-started/github-action/","title":"GitHub Action","text":"<p>Run Tomato tests in your CI/CD pipeline using the official GitHub Action.</p>"},{"location":"getting-started/github-action/#basic-usage","title":"Basic Usage","text":"<pre><code>name: Tests\non: [push, pull_request]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Run Tomato Tests\n        uses: tomatool/tomato@v2\n</code></pre>"},{"location":"getting-started/github-action/#inputs","title":"Inputs","text":"Input Description Default <code>version</code> Tomato version (e.g., <code>v1.0.0</code>) Action's tag version <code>config</code> Config file path <code>tomato.yml</code> <code>features</code> Feature files or directories <code>tags</code> Filter by tags (e.g., <code>@smoke and not @slow</code>) <code>scenario</code> Filter by scenario name (regex) <code>no-reset</code> Skip state reset between scenarios <code>false</code> <code>verbose</code> Show debug logs <code>false</code> <code>quiet</code> Hide application logs <code>false</code>"},{"location":"getting-started/github-action/#examples","title":"Examples","text":""},{"location":"getting-started/github-action/#filter-by-tags","title":"Filter by Tags","text":"<pre><code>- uses: tomatool/tomato@v2\n  with:\n    tags: '@smoke and not @slow'\n</code></pre>"},{"location":"getting-started/github-action/#filter-by-scenario-name","title":"Filter by Scenario Name","text":"<pre><code>- uses: tomatool/tomato@v2\n  with:\n    scenario: 'user registration'\n</code></pre>"},{"location":"getting-started/github-action/#run-specific-features","title":"Run Specific Features","text":"<pre><code>- uses: tomatool/tomato@v2\n  with:\n    features: 'features/api features/auth'\n</code></pre>"},{"location":"getting-started/github-action/#verbose-output","title":"Verbose Output","text":"<pre><code>- uses: tomatool/tomato@v2\n  with:\n    verbose: 'true'\n</code></pre>"},{"location":"getting-started/github-action/#pin-to-specific-version","title":"Pin to Specific Version","text":"<pre><code>- uses: tomatool/tomato@v2.0.0\n  with:\n    config: 'tomato.yml'\n</code></pre>"},{"location":"getting-started/github-action/#complete-workflow-example","title":"Complete Workflow Example","text":"<pre><code>name: Integration Tests\n\non:\n  push:\n    branches: [main]\n  pull_request:\n    branches: [main]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v4\n\n      - name: Run Tomato Tests\n        uses: tomatool/tomato@v2\n        with:\n          config: 'tomato.yml'\n          verbose: 'true'\n</code></pre>"},{"location":"getting-started/github-action/#requirements","title":"Requirements","text":"<ul> <li>Docker must be available in the runner (default for <code>ubuntu-latest</code>)</li> <li>Repository must contain a valid <code>tomato.yml</code> configuration</li> </ul>"},{"location":"resources/","title":"Available Resources","text":"<p>Tomato supports the following resource types for behavioral testing.</p> Resource Type Description HTTP Client <code>http</code> Steps for making HTTP requests and validating responses HTTP Server <code>http-server</code> Steps for stubbing HTTP services PostgreSQL <code>postgres</code> Steps for interacting with PostgreSQL databases Redis <code>redis</code> Steps for interacting with Redis key-value store Kafka <code>kafka</code> Steps for interacting with Apache Kafka message broker Shell <code>shell</code> Steps for executing shell commands and scripts WebSocket Client <code>websocket</code> Steps for connecting to WebSocket servers WebSocket Server <code>websocket-server</code> Steps for stubbing WebSocket services"},{"location":"resources/#variables-and-dynamic-values","title":"Variables and Dynamic Values","text":"<p>Tomato supports variables that can be used in URLs, headers, and request bodies. Variables use the <code>{{name}}</code> syntax.</p>"},{"location":"resources/#dynamic-value-generation","title":"Dynamic Value Generation","text":"<p>Built-in functions generate unique values on each use:</p> Function Example Output Description <code>{{uuid}}</code> <code>f47ac10b-58cc-4372-a567-0e02b2c3d479</code> Random UUID v4 <code>{{timestamp}}</code> <code>2024-01-15T10:30:00Z</code> Current ISO 8601 timestamp <code>{{timestamp:unix}}</code> <code>1705315800</code> Unix timestamp in seconds <code>{{random:N}}</code> <code>A8kL2mN9pQ</code> Random alphanumeric string of length N <code>{{random:N:numeric}}</code> <code>8472910384</code> Random numeric string of length N <code>{{sequence:name}}</code> <code>1</code>, <code>2</code>, <code>3</code>... Auto-incrementing sequence by name <p>Example: <pre><code>When \"api\" sends \"POST\" to \"/api/users\" with json:\n  \"\"\"\n  {\n    \"id\": \"{{uuid}}\",\n    \"username\": \"user_{{random:8}}\",\n    \"created_at\": \"{{timestamp}}\"\n  }\n  \"\"\"\n</code></pre></p>"},{"location":"resources/#capturing-response-values","title":"Capturing Response Values","text":"<p>Save values from responses to use in subsequent requests:</p> Step Description <code>\"api\" response json \"path\" saved as \"{{var}}\"</code> Save JSON path value to variable <code>\"api\" response header \"Name\" saved as \"{{var}}\"</code> Save response header to variable <p>Example - CRUD workflow: <pre><code>Scenario: Create and retrieve a user\n  # Create user and capture the ID\n  When \"api\" sends \"POST\" to \"/api/users\" with json:\n    \"\"\"\n    { \"name\": \"Alice\" }\n    \"\"\"\n  Then \"api\" response status is \"201\"\n  And \"api\" response json \"id\" saved as \"{{user_id}}\"\n\n  # Use captured ID in subsequent request\n  When \"api\" sends \"GET\" to \"/api/users/{{user_id}}\"\n  Then \"api\" response status is \"200\"\n  And \"api\" response json \"name\" is \"Alice\"\n\n  # Delete the user\n  When \"api\" sends \"DELETE\" to \"/api/users/{{user_id}}\"\n  Then \"api\" response status is \"204\"\n</code></pre></p> <p>Variables and sequences are automatically reset between scenarios.</p>"},{"location":"resources/#json-matchers","title":"JSON Matchers","text":"<p>When using <code>response json matches:</code> or <code>response json contains:</code>, you can use these matchers:</p>"},{"location":"resources/#type-matchers","title":"Type Matchers","text":"Matcher Description <code>@string</code> Matches any string value <code>@number</code> Matches any numeric value <code>@boolean</code> Matches true or false <code>@array</code> Matches any array <code>@object</code> Matches any object <code>@null</code> Matches null <code>@notnull</code> Matches any non-null value <code>@any</code> Matches any value <code>@empty</code> Matches empty string, array, or object <code>@notempty</code> Matches non-empty string, array, or object"},{"location":"resources/#string-matchers","title":"String Matchers","text":"Matcher Description <code>@regex:pattern</code> Matches string against regex pattern <code>@contains:text</code> Matches if string contains text <code>@startswith:text</code> Matches if string starts with text <code>@endswith:text</code> Matches if string ends with text"},{"location":"resources/#numeric-matchers","title":"Numeric Matchers","text":"Matcher Description <code>@gt:n</code> Matches if value &gt; n <code>@gte:n</code> Matches if value &gt;= n <code>@lt:n</code> Matches if value &lt; n <code>@lte:n</code> Matches if value &lt;= n"},{"location":"resources/#length-matcher","title":"Length Matcher","text":"Matcher Description <code>@len:n</code> Matches if length equals n (for strings, arrays, objects)"},{"location":"resources/#example","title":"Example","text":"<pre><code>Then \"api\" response json contains:\n  \"\"\"\n  {\n    \"id\": \"@regex:^[0-9a-f-]{36}$\",\n    \"name\": \"@notempty\",\n    \"email\": \"@contains:@\",\n    \"age\": \"@gt:0\",\n    \"tags\": \"@array\"\n  }\n  \"\"\"\n</code></pre>"},{"location":"resources/http-client/","title":"HTTP Client","text":"<p>Steps for making HTTP requests and validating responses</p>"},{"location":"resources/http-client/#request-setup","title":"Request Setup","text":"Step Description <code>\"api\" header \"Content-Type\" is \"application/json\"</code> Set a header <code>\"api\" headers are:</code> Set multiple headers from table <code>\"api\" query param \"page\" is \"1\"</code> Set a query parameter <code>\"api\" body is:</code> Set raw request body (docstring) <code>\"api\" json body is:</code> Set JSON body + Content-Type header <code>\"api\" form body is:</code> Set form-encoded body from table"},{"location":"resources/http-client/#request-execution","title":"Request Execution","text":"Step Description <code>\"api\" sends \"GET\" to \"/users\"</code> Send HTTP request <code>\"api\" sends \"POST\" to \"/users\" with body:</code> Send with raw body <code>\"api\" sends \"POST\" to \"/users\" with json:</code> Send with JSON body"},{"location":"resources/http-client/#response-status","title":"Response Status","text":"Step Description <code>\"api\" response status is \"200\"</code> Assert exact status code <code>\"api\" response status is success</code> Assert status class (2xx, 3xx, 4xx, 5xx)"},{"location":"resources/http-client/#response-headers","title":"Response Headers","text":"Step Description <code>\"api\" response header \"Content-Type\" is \"application/json\"</code> Assert exact header value <code>\"api\" response header \"Content-Type\" contains \"json\"</code> Assert header contains substring <code>\"api\" response header \"X-Request-Id\" exists</code> Assert header exists"},{"location":"resources/http-client/#response-body","title":"Response Body","text":"Step Description <code>\"api\" response body is:</code> Assert exact body match <code>\"api\" response body contains \"success\"</code> Assert body contains substring <code>\"api\" response body does not contain \"error\"</code> Assert body doesn't contain substring <code>\"api\" response body is empty</code> Assert empty body"},{"location":"resources/http-client/#response-json","title":"Response JSON","text":"Step Description <code>\"api\" response json \"data.id\" is \"123\"</code> Assert JSON path value <code>\"api\" response json \"data.id\" exists</code> Assert JSON path exists <code>\"api\" response json \"data.deleted\" does not exist</code> Assert JSON path doesn't exist <code>\"api\" response json matches:</code> Assert exact JSON structure with matchers: @string, @number, @boolean, @array, @object, @any, @null, @notnull, @empty, @notempty, @regex:pattern, @contains:text, @startswith:text, @endswith:text, @gt:n, @gte:n, @lt:n, @lte:n, @len:n <code>\"api\" response json contains:</code> Assert JSON contains specified fields (ignores extra fields). Supports same matchers as 'matches' <code>\"api\" response json \"id\" matches pattern \"^[0-9a-f-]{36}$\"</code> Assert JSON path value matches regex pattern <code>\"api\" response json \"id\" is uuid</code> Assert JSON path value is a valid UUID <code>\"api\" response json \"email\" is email</code> Assert JSON path value is a valid email format <code>\"api\" response json \"created_at\" is iso-timestamp</code> Assert JSON path value is an ISO 8601 timestamp"},{"location":"resources/http-client/#response-timing","title":"Response Timing","text":"Step Description <code>\"api\" response time is less than \"500ms\"</code> Assert response time"},{"location":"resources/http-client/#variable-capture","title":"Variable Capture","text":"Step Description <code>\"api\" response json \"id\" saved as \"{{user_id}}\"</code> Save JSON path value to variable for use in subsequent requests <code>\"api\" response header \"Location\" saved as \"{{location}}\"</code> Save response header value to variable"},{"location":"resources/http-server/","title":"HTTP Server","text":"<p>Steps for stubbing HTTP services</p>"},{"location":"resources/http-server/#stub-setup","title":"Stub Setup","text":"Step Description <code>\"{resource}\" stub \"GET\" \"/users\" returns \"200\"</code> Creates a stub that returns a status code `\"{resource}\" stub \"GET\" \"/users\" returns \"200\" with body: \"\"\" [{\"id\": 1}] \"\"\"` Creates a stub that returns a status code and body `\"{resource}\" stub \"GET\" \"/users\" returns \"200\" with json: \"\"\" [{\"id\": 1}] \"\"\"` Creates a stub that returns JSON (auto sets Content-Type) `\"{resource}\" stub \"GET\" \"/users\" returns \"200\" with headers: header value X-Custom value"},{"location":"resources/http-server/#verification","title":"Verification","text":"Step Description <code>\"{resource}\" received \"GET\" \"/users\"</code> Asserts a request was received <code>\"{resource}\" received \"GET\" \"/users\" \"2\" times</code> Asserts a request was received N times <code>\"{resource}\" did not receive \"DELETE\" \"/users\"</code> Asserts a request was not received <code>\"{resource}\" received request with header \"Authorization\" containing \"Bearer\"</code> Asserts any request was received with header containing value <code>\"{resource}\" received request with body containing \"name\"</code> Asserts any request was received with body containing value <code>\"{resource}\" received \"5\" requests</code> Asserts total number of requests received"},{"location":"resources/http-server/#server-info","title":"Server Info","text":"Step Description <code>\"{resource}\" url is stored in \"SERVER_URL\"</code> Stores the server URL in a variable for use in other steps"},{"location":"resources/kafka/","title":"Kafka","text":"<p>Steps for interacting with Apache Kafka message broker</p>"},{"location":"resources/kafka/#topic-management","title":"Topic Management","text":"Step Description <code>\"{resource}\" topic \"events\" exists</code> Asserts a Kafka topic exists <code>\"{resource}\" creates topic \"events\"</code> Creates a Kafka topic with 1 partition <code>\"{resource}\" creates topic \"events\" with \"3\" partitions</code> Creates a Kafka topic with specified partitions"},{"location":"resources/kafka/#publishing","title":"Publishing","text":"Step Description `\"{resource}\" publishes to \"events\": \"\"\" Hello World \"\"\"` Publishes a message to a topic `\"{resource}\" publishes to \"events\" with key \"user-123\": \"\"\" Hello World \"\"\"` Publishes a message with a key to a topic `\"{resource}\" publishes json to \"events\": \"\"\" {\"type\": \"user_created\"} \"\"\"` Publishes a JSON message to a topic `\"{resource}\" publishes json to \"events\" with key \"user-123\": \"\"\" {\"type\": \"user_created\"} \"\"\"` Publishes a JSON message with a key `\"{resource}\" publishes messages to \"events\": key value user-1 {\"id\": 1}"},{"location":"resources/kafka/#consuming","title":"Consuming","text":"Step Description <code>\"{resource}\" consumes from \"events\"</code> Starts consuming messages from a topic <code>\"{resource}\" receives from \"events\" within \"5s\"</code> Waits for a message from a topic within timeout `\"{resource}\" receives from \"events\" within \"5s\": \"\"\" Hello World \"\"\"` Asserts a specific message is received within timeout <code>\"{resource}\" receives from \"events\" with key \"user-123\" within \"5s\"</code> Asserts a message with specific key is received"},{"location":"resources/kafka/#assertions","title":"Assertions","text":"Step Description <code>\"{resource}\" topic \"events\" has \"3\" messages</code> Asserts topic has exactly N messages consumed <code>\"{resource}\" topic \"events\" is empty</code> Asserts no messages have been consumed from topic `\"{resource}\" last message contains: \"\"\" user_created \"\"\"` Asserts the last consumed message contains content <code>\"{resource}\" last message has key \"user-123\"</code> Asserts the last consumed message has specific key <code>\"{resource}\" last message has header \"content-type\" with value \"application/json\"</code> Asserts the last message has a header with value `\"{resource}\" receives messages from \"events\" in order: key value key1 msg1"},{"location":"resources/postgres/","title":"PostgreSQL","text":"<p>Steps for interacting with PostgreSQL databases</p>"},{"location":"resources/postgres/#data-setup","title":"Data Setup","text":"Step Description <code>\"db\" table \"users\" has values:</code> Insert rows from table <code>\"db\" clears table \"users\"</code> Truncate a table (removes all rows) <code>\"db\" clears tables:</code> Truncate multiple tables from list <code>\"db\" executes:</code> Execute raw SQL <code>\"db\" executes file \"fixtures/seed.sql\"</code> Execute SQL from file"},{"location":"resources/postgres/#assertions","title":"Assertions","text":"Step Description <code>\"db\" table \"users\" contains:</code> Assert table contains rows <code>\"db\" table \"users\" is empty</code> Assert table is empty <code>\"db\" table \"users\" has \"5\" rows</code> Assert row count"},{"location":"resources/rabbitmq/","title":"RabbitMQ","text":"<p>Steps for interacting with RabbitMQ message broker</p>"},{"location":"resources/rabbitmq/#queue-management","title":"Queue Management","text":"Step Description <code>\"{resource}\" declares queue \"orders\"</code> Declares a queue with default settings <code>\"{resource}\" declares durable queue \"orders\"</code> Declares a durable queue <code>\"{resource}\" queue \"orders\" exists</code> Asserts a queue exists <code>\"{resource}\" purges queue \"orders\"</code> Purges all messages from a queue"},{"location":"resources/rabbitmq/#exchange-management","title":"Exchange Management","text":"Step Description <code>\"{resource}\" declares exchange \"events\" of type \"topic\"</code> Declares an exchange (direct, fanout, topic, headers) <code>\"{resource}\" declares durable exchange \"events\" of type \"topic\"</code> Declares a durable exchange <code>\"{resource}\" exchange \"events\" exists</code> Asserts an exchange exists"},{"location":"resources/rabbitmq/#bindings","title":"Bindings","text":"Step Description <code>\"{resource}\" binds queue \"orders\" to exchange \"events\"</code> Binds a queue to an exchange with empty routing key <code>\"{resource}\" binds queue \"orders\" to exchange \"events\" with routing key \"order.*\"</code> Binds a queue to an exchange with a routing key"},{"location":"resources/rabbitmq/#publishing","title":"Publishing","text":"Step Description `\"{resource}\" publishes to queue \"orders\": \"\"\" Hello World \"\"\"` Publishes a message directly to a queue `\"{resource}\" publishes json to queue \"orders\": \"\"\" {\"order_id\": 123} \"\"\"` Publishes a JSON message directly to a queue `\"{resource}\" publishes to exchange \"events\" with routing key \"order.created\": \"\"\" Order created \"\"\"` Publishes a message to an exchange with routing key `\"{resource}\" publishes json to exchange \"events\" with routing key \"order.created\": \"\"\" {\"event\": \"order.created\"} \"\"\"` Publishes a JSON message to an exchange with routing key `\"{resource}\" publishes messages to queue \"orders\": message message 1 message 2 `"},{"location":"resources/rabbitmq/#consuming","title":"Consuming","text":"Step Description <code>\"{resource}\" consumes from queue \"orders\"</code> Starts consuming messages from a queue <code>\"{resource}\" receives from queue \"orders\" within \"5s\"</code> Waits for a message from a queue within timeout `\"{resource}\" receives from queue \"orders\" within \"5s\": \"\"\" Hello World \"\"\"` Asserts a specific message is received within timeout"},{"location":"resources/rabbitmq/#assertions","title":"Assertions","text":"Step Description <code>\"{resource}\" queue \"orders\" has \"3\" messages</code> Asserts queue has exactly N messages consumed <code>\"{resource}\" queue \"orders\" is empty</code> Asserts no messages have been consumed from queue `\"{resource}\" last message contains: \"\"\" order_id \"\"\"` Asserts the last consumed message contains content <code>\"{resource}\" last message has routing key \"order.created\"</code> Asserts the last consumed message has specific routing key <code>\"{resource}\" last message has header \"content-type\" with value \"application/json\"</code> Asserts the last message has a header with value"},{"location":"resources/redis/","title":"Redis","text":"<p>Steps for interacting with Redis key-value store</p>"},{"location":"resources/redis/#string-operations","title":"String Operations","text":"Step Description <code>\"cache\" key \"user:1\" is \"John\"</code> Set a string value <code>\"cache\" key \"session:abc\" is \"data\" with TTL \"1h\"</code> Set a string value with expiration <code>\"cache\" key \"user:1\" is:</code> Set a JSON/multiline value <code>\"cache\" key \"user:1\" is deleted</code> Delete a key <code>\"cache\" key \"counter\" is incremented</code> Increment integer value by 1 <code>\"cache\" key \"counter\" is incremented by \"5\"</code> Increment integer value by N <code>\"cache\" key \"counter\" is decremented</code> Decrement integer value by 1"},{"location":"resources/redis/#string-assertions","title":"String Assertions","text":"Step Description <code>\"cache\" key \"user:1\" exists</code> Assert key exists <code>\"cache\" key \"user:1\" does not exist</code> Assert key doesn't exist <code>\"cache\" key \"user:1\" has value \"John\"</code> Assert exact value <code>\"cache\" key \"user:1\" contains \"John\"</code> Assert value contains substring <code>\"cache\" key \"session:abc\" has TTL greater than \"3600\" seconds</code> Assert TTL greater than N seconds"},{"location":"resources/redis/#hash-operations","title":"Hash Operations","text":"Step Description <code>\"cache\" hash \"user:1\" has fields:</code> Set hash fields from table <code>\"cache\" hash \"user:1\" field \"name\" is \"John\"</code> Assert hash field value <code>\"cache\" hash \"user:1\" contains:</code> Assert hash contains fields"},{"location":"resources/redis/#list-operations","title":"List Operations","text":"Step Description <code>\"cache\" list \"queue\" has \"item1\"</code> Push value to list <code>\"cache\" list \"queue\" has values:</code> Push multiple values to list <code>\"cache\" list \"queue\" has \"3\" items</code> Assert list length <code>\"cache\" list \"queue\" contains \"item1\"</code> Assert list contains value"},{"location":"resources/redis/#set-operations","title":"Set Operations","text":"Step Description <code>\"cache\" set \"tags\" has \"tag1\"</code> Add member to set <code>\"cache\" set \"tags\" has members:</code> Add multiple members to set <code>\"cache\" set \"tags\" contains \"tag1\"</code> Assert set contains member <code>\"cache\" set \"tags\" has \"3\" members</code> Assert set size"},{"location":"resources/redis/#database","title":"Database","text":"Step Description <code>\"cache\" has \"5\" keys</code> Assert total key count <code>\"cache\" is empty</code> Assert database is empty"},{"location":"resources/shell/","title":"Shell","text":"<p>Steps for executing shell commands and scripts</p>"},{"location":"resources/shell/#setup","title":"Setup","text":"Step Description <code>\"shell\" env \"API_KEY\" is \"secret\"</code> Set environment variable <code>\"shell\" workdir is \"/tmp/test\"</code> Set working directory"},{"location":"resources/shell/#execution","title":"Execution","text":"Step Description <code>\"shell\" runs:</code> Run command (docstring) <code>\"shell\" runs \"ls -la\"</code> Run inline command <code>\"shell\" runs script \"scripts/setup.sh\"</code> Run script file <code>\"shell\" runs with timeout \"60s\":</code> Run with custom timeout"},{"location":"resources/shell/#exit-code","title":"Exit Code","text":"Step Description <code>\"shell\" exit code is \"0\"</code> Assert exit code <code>\"shell\" succeeds</code> Assert exit code 0 <code>\"shell\" fails</code> Assert non-zero exit code"},{"location":"resources/shell/#output","title":"Output","text":"Step Description <code>\"shell\" stdout contains \"success\"</code> Assert stdout contains substring <code>\"shell\" stdout does not contain \"error\"</code> Assert stdout doesn't contain <code>\"shell\" stdout is:</code> Assert exact stdout <code>\"shell\" stdout is empty</code> Assert stdout empty <code>\"shell\" stderr contains \"warning\"</code> Assert stderr contains substring <code>\"shell\" stderr is empty</code> Assert stderr empty"},{"location":"resources/shell/#files","title":"Files","text":"Step Description <code>\"shell\" file \"output.txt\" exists</code> Assert file exists <code>\"shell\" file \"temp.txt\" does not exist</code> Assert file doesn't exist <code>\"shell\" file \"config.json\" contains \"database\"</code> Assert file contains substring"},{"location":"resources/websocket-client/","title":"WebSocket Client","text":"<p>Steps for connecting to WebSocket servers</p>"},{"location":"resources/websocket-client/#connection","title":"Connection","text":"Step Description <code>\"ws\" connects</code> Connect to WebSocket endpoint <code>\"ws\" connects with headers:</code> Connect with custom headers <code>\"ws\" disconnects</code> Disconnect from WebSocket <code>\"ws\" is connected</code> Assert connected <code>\"ws\" is disconnected</code> Assert disconnected"},{"location":"resources/websocket-client/#sending","title":"Sending","text":"Step Description <code>\"ws\" sends:</code> Send text message (docstring) <code>\"ws\" sends \"ping\"</code> Send short text message <code>\"ws\" sends json:</code> Send JSON message"},{"location":"resources/websocket-client/#receiving","title":"Receiving","text":"Step Description <code>\"ws\" receives within \"5s\":</code> Assert message received within timeout <code>\"ws\" receives within \"5s\" containing \"success\"</code> Assert message containing substring received <code>\"ws\" receives json within \"5s\" matching:</code> Assert JSON message matching structure <code>\"ws\" receives \"3\" messages within \"10s\"</code> Assert N messages received within timeout <code>\"ws\" does not receive within \"2s\"</code> Assert no message received"},{"location":"resources/websocket-client/#assertions","title":"Assertions","text":"Step Description <code>\"ws\" last message is:</code> Assert last message matches exactly <code>\"ws\" last message contains \"success\"</code> Assert last message contains substring <code>\"ws\" last message is json matching:</code> Assert last message is JSON matching structure <code>\"ws\" received \"5\" messages</code> Assert total message count"},{"location":"resources/websocket-server/","title":"WebSocket Server","text":"<p>Steps for stubbing WebSocket services</p>"},{"location":"resources/websocket-server/#setup","title":"Setup","text":"Step Description `\"{resource}\" on connect sends: \"\"\" {\"type\": \"welcome\"} \"\"\"` Sends a message when a client connects `\"{resource}\" on message \"ping\" replies: \"\"\" pong \"\"\"` Replies to an exact message `\"{resource}\" on message matching \".subscribe.\" replies: \"\"\" {\"status\": \"subscribed\"} \"\"\"` Replies to messages matching a regex pattern"},{"location":"resources/websocket-server/#broadcast","title":"Broadcast","text":"Step Description `\"{resource}\" broadcasts: \"\"\" {\"event\": \"update\"} \"\"\"` Broadcasts a message to all connected clients <code>\"{resource}\" broadcasts \"ping\"</code> Broadcasts a short message to all connected clients"},{"location":"resources/websocket-server/#assertions","title":"Assertions","text":"Step Description <code>\"{resource}\" has \"2\" connections</code> Asserts the number of connected clients <code>\"{resource}\" received message \"ping\"</code> Asserts a specific message was received <code>\"{resource}\" received \"3\" messages</code> Asserts the total number of messages received"}]}