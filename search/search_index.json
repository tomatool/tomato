{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"\ud83c\udf45 tomato - behavioral testing toolkit","text":"<p>[!WARNING] v2 is currently under active development. This version contains breaking changes and may not be stable.</p> <p>Looking for the stable version? v1 is available here, but will not receive future updates as development focuses on v2.</p> <p>Use v2 at your own risk - APIs and features may change without notice.</p> <p>Tomato is a language-agnostic behavioral testing framework that manages your test infrastructure automatically.</p>"},{"location":"#features","title":"Features","text":"<ul> <li>Built-in Container Orchestration - Automatically manage test containers with Testcontainers</li> <li>Clean State Testing - Reset resources between scenarios for reliable, isolated tests</li> <li>BDD/Gherkin Support - Write tests in plain English using Cucumber syntax</li> <li>Multiple Resource Types - HTTP, PostgreSQL, Redis, Kafka, WebSocket, Shell</li> <li>Auto-generated Documentation - Keep step docs in sync with code</li> <li>Application Runner - Start your app connected to test containers</li> </ul>"},{"location":"#installation","title":"Installation","text":"<pre><code># Quick Install\ncurl -fsSL https://raw.githubusercontent.com/tomatool/tomato/main/install.sh | sh\n\n# Using Go\ngo install github.com/tomatool/tomato@latest\n\n# Using Homebrew\nbrew install tomatool/tap/tomato\n</code></pre>"},{"location":"#quick-start","title":"Quick Start","text":"<pre><code>tomato init    # Initialize a new project\ntomato run     # Run behavioral tests\ntomato steps   # List available steps\n</code></pre>"},{"location":"#documentation","title":"Documentation","text":"<p>For complete documentation, visit tomatool.github.io/tomato</p> <ul> <li>Getting Started</li> <li>Configuration Reference</li> <li>Architecture</li> <li>Step Reference</li> </ul>"},{"location":"#license","title":"License","text":"<p>Tomato is open source under the MIT License.</p>"},{"location":"architecture/","title":"Architecture","text":"<p>This page provides an overview of tomato's internal architecture and how components interact during test execution.</p>"},{"location":"architecture/#high-level-overview","title":"High-Level Overview","text":"<p>tomato is designed around three core concepts:</p> <ol> <li>Containers - Docker containers managed via Testcontainers</li> <li>Resources - Abstractions over external services (databases, APIs, message queues)</li> <li>Handlers - Step definitions that interact with resources</li> </ol> <pre><code>flowchart TB\n    subgraph Config[\"tomato.yml\"]\n        C[Containers]\n        R[Resources]\n        F[Features]\n    end\n\n    subgraph Runtime[\"tomato Runtime\"]\n        TC[Testcontainers]\n        H[Handlers]\n        G[Gherkin Parser]\n    end\n\n    subgraph External[\"External Services\"]\n        DB[(PostgreSQL)]\n        REDIS[(Redis)]\n        KAFKA[(Kafka)]\n        HTTP[HTTP Server]\n        WS[WebSocket]\n    end\n\n    C --&gt; TC\n    R --&gt; H\n    F --&gt; G\n\n    TC --&gt; DB\n    TC --&gt; REDIS\n    TC --&gt; KAFKA\n\n    H --&gt; DB\n    H --&gt; REDIS\n    H --&gt; KAFKA\n    H --&gt; HTTP\n    H --&gt; WS\n\n    G --&gt; H</code></pre>"},{"location":"architecture/#test-execution-flow","title":"Test Execution Flow","text":"<p>When you run <code>tomato run</code>, the following sequence occurs:</p> <pre><code>sequenceDiagram\n    participant User\n    participant CLI\n    participant Config\n    participant TC as Testcontainers\n    participant App as Application\n    participant Handler\n    participant Godog\n\n    User-&gt;&gt;CLI: tomato run\n    CLI-&gt;&gt;Config: Parse tomato.yml\n\n    rect rgb(40, 40, 40)\n        Note over TC: Container Setup\n        Config-&gt;&gt;TC: Start containers\n        TC--&gt;&gt;TC: Wait for readiness\n        TC--&gt;&gt;Config: Container endpoints\n    end\n\n    rect rgb(40, 40, 40)\n        Note over App: App Setup (optional)\n        Config-&gt;&gt;App: Start application\n        App--&gt;&gt;App: Wait for ready check\n    end\n\n    rect rgb(40, 40, 40)\n        Note over Handler: Resource Setup\n        Config-&gt;&gt;Handler: Initialize handlers\n        Handler--&gt;&gt;Handler: Connect to services\n    end\n\n    rect rgb(40, 40, 40)\n        Note over Godog: Test Execution\n        CLI-&gt;&gt;Godog: Run features\n        loop Each Scenario\n            Godog-&gt;&gt;Handler: Reset resources\n            loop Each Step\n                Godog-&gt;&gt;Handler: Execute step\n                Handler--&gt;&gt;Godog: Result\n            end\n        end\n    end\n\n    Godog--&gt;&gt;CLI: Test results\n    CLI-&gt;&gt;TC: Stop containers\n    CLI-&gt;&gt;App: Stop application\n    CLI--&gt;&gt;User: Exit code</code></pre>"},{"location":"architecture/#handler-architecture","title":"Handler Architecture","text":"<p>Handlers are responsible for translating Gherkin steps into actions against resources:</p> <pre><code>flowchart LR\n    subgraph Steps[\"Gherkin Steps\"]\n        S1[\"Given I set 'db' table...\"]\n        S2[\"When I send 'GET' request...\"]\n        S3[\"Then response status is '200'\"]\n    end\n\n    subgraph Handlers[\"Handler Registry\"]\n        PG[PostgreSQL Handler]\n        HTTP[HTTP Client Handler]\n        REDIS[Redis Handler]\n        KAFKA[Kafka Handler]\n        WS[WebSocket Handler]\n        SHELL[Shell Handler]\n    end\n\n    subgraph Resources[\"Resources\"]\n        DB[(Database)]\n        API[HTTP API]\n        CACHE[(Cache)]\n        MQ[(Message Queue)]\n        WSS[WebSocket Server]\n        CMD[Shell]\n    end\n\n    S1 --&gt; PG\n    S2 --&gt; HTTP\n    S3 --&gt; HTTP\n\n    PG --&gt; DB\n    HTTP --&gt; API\n    REDIS --&gt; CACHE\n    KAFKA --&gt; MQ\n    WS --&gt; WSS\n    SHELL --&gt; CMD</code></pre>"},{"location":"architecture/#resource-lifecycle","title":"Resource Lifecycle","text":"<p>Each resource follows a consistent lifecycle:</p> <pre><code>stateDiagram-v2\n    [*] --&gt; Configured: Parse config\n    Configured --&gt; Initialized: Initialize handler\n    Initialized --&gt; Connected: Connect to service\n    Connected --&gt; Ready: Ready for tests\n\n    Ready --&gt; Reset: Before scenario\n    Reset --&gt; Ready: Clean state\n\n    Ready --&gt; Closed: Tests complete\n    Closed --&gt; [*]</code></pre>"},{"location":"architecture/#container-orchestration","title":"Container Orchestration","text":"<p>tomato uses Testcontainers to manage Docker containers:</p> <pre><code>flowchart TB\n    subgraph Config[\"Configuration\"]\n        YAML[\"tomato.yml\"]\n    end\n\n    subgraph Testcontainers[\"Testcontainers Runtime\"]\n        CM[Container Manager]\n        NW[Network]\n\n        subgraph Containers\n            C1[postgres:15]\n            C2[redis:7]\n            C3[kafka:latest]\n        end\n    end\n\n    subgraph WaitStrategies[\"Wait Strategies\"]\n        PORT[Port Check]\n        HTTP_CHECK[HTTP Check]\n        LOG[Log Pattern]\n    end\n\n    YAML --&gt; CM\n    CM --&gt; NW\n    CM --&gt; C1\n    CM --&gt; C2\n    CM --&gt; C3\n\n    C1 --&gt; PORT\n    C2 --&gt; PORT\n    C3 --&gt; LOG</code></pre>"},{"location":"architecture/#data-flow-example","title":"Data Flow Example","text":"<p>Here's how a typical database test scenario flows through the system:</p> <pre><code>sequenceDiagram\n    participant Feature as Feature File\n    participant Godog\n    participant PG as PostgreSQL Handler\n    participant DB as PostgreSQL\n\n    Note over Feature: Scenario: Create user\n\n    Feature-&gt;&gt;Godog: Given I set \"db\" table \"users\"...\n    Godog-&gt;&gt;PG: SetTableValues(table, data)\n    PG-&gt;&gt;DB: INSERT INTO users...\n    DB--&gt;&gt;PG: OK\n    PG--&gt;&gt;Godog: Success\n\n    Feature-&gt;&gt;Godog: When I execute on \"db\" query...\n    Godog-&gt;&gt;PG: ExecuteQuery(query)\n    PG-&gt;&gt;DB: SELECT * FROM users\n    DB--&gt;&gt;PG: Results\n    PG--&gt;&gt;Godog: Store results\n\n    Feature-&gt;&gt;Godog: Then \"db\" query result should be...\n    Godog-&gt;&gt;PG: AssertQueryResult(expected)\n    PG--&gt;&gt;Godog: Match/No match</code></pre>"},{"location":"architecture/#http-requestresponse-flow","title":"HTTP Request/Response Flow","text":"<pre><code>sequenceDiagram\n    participant Feature as Feature File\n    participant HTTP as HTTP Handler\n    participant API as Target API\n\n    Feature-&gt;&gt;HTTP: Given I set request header...\n    HTTP--&gt;&gt;HTTP: Store header\n\n    Feature-&gt;&gt;HTTP: When I send \"POST\" to \"/users\"\n    HTTP-&gt;&gt;API: POST /users\n    API--&gt;&gt;HTTP: 201 Created + JSON body\n    HTTP--&gt;&gt;HTTP: Store response\n\n    Feature-&gt;&gt;HTTP: Then response status is \"201\"\n    HTTP--&gt;&gt;HTTP: Assert status\n\n    Feature-&gt;&gt;HTTP: And response JSON \"id\" exists\n    HTTP--&gt;&gt;HTTP: Assert JSON path</code></pre>"},{"location":"architecture/#configuration-structure","title":"Configuration Structure","text":"<pre><code>flowchart TB\n    subgraph tomato.yml\n        direction TB\n        V[version: 2]\n\n        subgraph containers\n            C1[name: postgres&lt;br/&gt;image: postgres:15&lt;br/&gt;env: ...&lt;br/&gt;wait_for: ...]\n            C2[name: redis&lt;br/&gt;image: redis:7]\n        end\n\n        subgraph resources\n            R1[name: db&lt;br/&gt;type: postgres&lt;br/&gt;container: postgres]\n            R2[name: cache&lt;br/&gt;type: redis&lt;br/&gt;container: redis]\n            R3[name: api&lt;br/&gt;type: http&lt;br/&gt;base_url: ...]\n        end\n\n        subgraph app\n            A[command: go run ./cmd/server&lt;br/&gt;port: 8080&lt;br/&gt;ready: http /health&lt;br/&gt;env: ...]\n        end\n\n        subgraph features\n            F[paths:&lt;br/&gt;  - ./features]\n        end\n    end</code></pre>"},{"location":"architecture/#error-handling","title":"Error Handling","text":"<p>When a step fails, tomato provides detailed error information:</p> <pre><code>flowchart TB\n    Step[Step Execution] --&gt; Check{Success?}\n    Check --&gt;|Yes| Next[Next Step]\n    Check --&gt;|No| Error[Error Details]\n\n    Error --&gt; Type{Error Type}\n    Type --&gt;|Connection| Conn[Connection failed to resource]\n    Type --&gt;|Assertion| Assert[Expected vs Actual mismatch]\n    Type --&gt;|Timeout| Timeout[Operation timed out]\n    Type --&gt;|Syntax| Syntax[Invalid step syntax]\n\n    Conn --&gt; Report[Report to User]\n    Assert --&gt; Report\n    Timeout --&gt; Report\n    Syntax --&gt; Report\n\n    Report --&gt; Cleanup[Cleanup Resources]\n    Cleanup --&gt; Exit[Exit with error code]</code></pre>"},{"location":"configuration/","title":"Configuration Reference","text":"<p>Complete reference for <code>tomato.yml</code> configuration options.</p>"},{"location":"configuration/#file-structure","title":"File Structure","text":"<pre><code>version: 2              # Required: config version\n\nsettings:               # Test execution settings\n  timeout: 5m\n  parallel: 1\n  fail_fast: false\n  output: pretty\n  reset:\n    level: scenario\n    on_failure: reset\n\napp:                    # Application under test (optional)\n  command: ./my-app\n  port: 8080\n  ready:\n    type: http\n    path: /health\n  wait: 5s\n  env:\n    KEY: value\n\ncontainers:             # Container definitions\n  name:\n    image: image:tag\n    env: {}\n    ports: []\n    volumes: []\n    depends_on: []\n    wait_for: {}\n    reset: {}\n\nresources:              # Resource/handler definitions\n  name:\n    type: http|http-server|postgres|redis|kafka|websocket|websocket-server|shell\n    container: container_name\n    options: {}\n\nhooks:                  # Lifecycle hooks\n  before_all: []\n  after_all: []\n  before_scenario: []\n  after_scenario: []\n\nfeatures:               # Feature file settings\n  paths:\n    - ./features\n  tags: \"\"\n</code></pre>"},{"location":"configuration/#settings","title":"Settings","text":"Field Type Default Description <code>timeout</code> duration <code>5m</code> Global test timeout <code>parallel</code> int <code>1</code> Number of parallel scenarios <code>fail_fast</code> bool <code>false</code> Stop on first failure <code>output</code> string <code>pretty</code> Output format: <code>pretty</code>, <code>progress</code>, <code>junit</code> <code>reset.level</code> string <code>scenario</code> Reset level: <code>scenario</code>, <code>feature</code>, <code>run</code>, <code>none</code> <code>reset.on_failure</code> string <code>reset</code> On failure: <code>reset</code>, <code>keep</code>"},{"location":"configuration/#app-configuration","title":"App Configuration","text":"<p>Configure your application under test to run with test containers.</p> <pre><code>app:\n  # Option 1: Run a command\n  command: go run ./cmd/server\n  workdir: ./\n\n  # Option 2: Build from Dockerfile\n  build:\n    dockerfile: Dockerfile\n    context: .\n\n  # Connection settings\n  port: 8080\n  ready:\n    type: http          # http, tcp, or exec\n    path: /health       # For HTTP checks\n    status: 200         # Expected status (default: 200)\n    timeout: 30s        # Ready check timeout\n\n  # Wait after ready check passes\n  wait: 5s\n\n  # Environment variables (supports container templates)\n  env:\n    DATABASE_URL: \"postgres://test:test@{{.postgres.host}}:{{.postgres.port}}/test\"\n    REDIS_URL: \"redis://{{.redis.host}}:{{.redis.port}}\"\n</code></pre>"},{"location":"configuration/#template-variables","title":"Template Variables","text":"<p>In <code>app.env</code>, you can use templates to inject container addresses:</p> Template Description <code>{{.container_name.host}}</code> Container hostname (e.g., <code>localhost</code> or Docker network IP) <code>{{.container_name.port}}</code> Container's mapped port (dynamically assigned) <p>Example with PostgreSQL: <pre><code>containers:\n  postgres:\n    image: postgres:15\n    env:\n      POSTGRES_USER: testuser\n      POSTGRES_PASSWORD: testpass\n      POSTGRES_DB: testdb\n    ports:\n      - \"5432\"\n\napp:\n  command: ./my-app\n  env:\n    # These are resolved at runtime when containers start\n    DB_HOST: \"{{.postgres.host}}\"\n    DB_PORT: \"{{.postgres.port}}\"\n    DATABASE_URL: \"postgres://testuser:testpass@{{.postgres.host}}:{{.postgres.port}}/testdb\"\n</code></pre></p> <p>Note: The <code>container</code> field in resource definitions automatically handles host/port resolution - you don't need to specify connection strings manually for resources.</p>"},{"location":"configuration/#containers","title":"Containers","text":"<p>Define Docker containers for your test infrastructure.</p> <pre><code>containers:\n  postgres:\n    image: postgres:15\n    env:\n      POSTGRES_USER: test\n      POSTGRES_PASSWORD: test\n      POSTGRES_DB: test\n    ports:\n      - \"5432\"\n    volumes:\n      - ./init.sql:/docker-entrypoint-initdb.d/init.sql\n    depends_on:\n      - other_container\n    wait_for:\n      type: port\n      target: \"5432\"\n      timeout: 30s\n    reset:\n      strategy: truncate\n      exclude:\n        - schema_migrations\n</code></pre>"},{"location":"configuration/#wait-strategies","title":"Wait Strategies","text":"Type Description Fields <code>port</code> Wait for port to be ready <code>target</code> <code>log</code> Wait for log message <code>target</code> (regex) <code>http</code> Wait for HTTP endpoint <code>method</code>, <code>path</code>, <code>port</code> <code>exec</code> Run command in container <code>target</code> (command)"},{"location":"configuration/#reset-strategies","title":"Reset Strategies","text":"Strategy Description <code>truncate</code> Truncate tables (Postgres) <code>flush</code> Flush database (Redis) <code>delete_recreate</code> Delete and recreate topics (Kafka) <code>none</code> No reset"},{"location":"configuration/#resources","title":"Resources","text":"<p>Define handlers for test steps.</p>"},{"location":"configuration/#http","title":"HTTP","text":"<pre><code>resources:\n  api:\n    type: http\n    base_url: http://localhost:8080\n    options:\n      timeout: 30s\n      headers:\n        Authorization: Bearer token\n</code></pre>"},{"location":"configuration/#postgresql","title":"PostgreSQL","text":"<pre><code>resources:\n  db:\n    type: postgres\n    container: postgres\n    database: test\n    options:\n      user: test\n      password: test\n      # Only truncate these tables during reset (if not set, truncates ALL public tables)\n      tables:\n        - users\n        - orders\n        - products\n      # Always exclude these tables from truncation\n      exclude:\n        - schema_migrations\n        - goose_db_version\n</code></pre>"},{"location":"configuration/#reset-behavior","title":"Reset Behavior","text":"<p>By default, PostgreSQL resources truncate all tables in the public schema before each scenario. You can control this behavior:</p> Option Description <code>tables</code> If set, only these tables are truncated (instead of all) <code>exclude</code> Tables to never truncate (default: <code>schema_migrations</code>, <code>goose_db_version</code>) <p>The <code>container</code> field automatically provides the connection details - tomato resolves the container's host and port at runtime.</p>"},{"location":"configuration/#redis","title":"Redis","text":"<pre><code>resources:\n  cache:\n    type: redis\n    container: redis\n    options:\n      db: 0\n      password: \"\"\n      reset_strategy: flush  # flush or pattern\n      reset_pattern: \"*\"     # For pattern strategy\n</code></pre>"},{"location":"configuration/#kafka","title":"Kafka","text":"<pre><code>resources:\n  kafka:\n    type: kafka\n    container: kafka\n    options:\n      topics:\n        - events\n        - notifications\n      partitions: 1\n      replication_factor: 1\n      reset_strategy: delete_recreate\n</code></pre>"},{"location":"configuration/#websocket","title":"WebSocket","text":"<pre><code>resources:\n  ws:\n    type: websocket\n    url: ws://localhost:8080/ws\n    # Or use container\n    container: app\n    options:\n      port: \"8080\"\n      path: /ws\n      protocols:\n        - graphql-ws\n      headers:\n        Authorization: Bearer token\n</code></pre>"},{"location":"configuration/#shell","title":"Shell","text":"<pre><code>resources:\n  shell:\n    type: shell\n    options:\n      timeout: 30s\n      workdir: ./scripts\n      env:\n        PATH: /usr/local/bin\n</code></pre>"},{"location":"configuration/#hooks","title":"Hooks","text":"<p>Execute actions at different lifecycle points.</p> <pre><code>hooks:\n  before_all:\n    - sql_file: ./fixtures/schema.sql\n      resource: db\n    - shell: ./scripts/setup.sh\n\n  after_all:\n    - shell: ./scripts/cleanup.sh\n\n  before_scenario:\n    - sql: \"DELETE FROM events\"\n      resource: db\n\n  after_scenario:\n    - exec: redis-cli FLUSHDB\n      container: redis\n</code></pre>"},{"location":"configuration/#hook-types","title":"Hook Types","text":"Type Description <code>sql</code> Execute SQL query <code>sql_file</code> Execute SQL file <code>shell</code> Run shell command <code>exec</code> Run command in container"},{"location":"configuration/#features","title":"Features","text":"<p>Configure feature file discovery.</p> <pre><code>features:\n  paths:\n    - ./features\n    - ./integration/features\n  tags: \"@smoke and not @slow\"\n</code></pre>"},{"location":"configuration/#tag-expressions","title":"Tag Expressions","text":"Expression Description <code>@smoke</code> Scenarios tagged with @smoke <code>@smoke and @api</code> Both tags <code>@smoke or @api</code> Either tag <code>not @slow</code> Exclude slow tests <code>@smoke and not @wip</code> Smoke tests, excluding WIP"},{"location":"configuration/#environment-variables","title":"Environment Variables","text":"<p>Use environment variables anywhere in the config:</p> <pre><code>containers:\n  postgres:\n    image: postgres:${POSTGRES_VERSION:-15}\n    env:\n      POSTGRES_PASSWORD: ${DB_PASSWORD}\n</code></pre>"},{"location":"getting-started/","title":"Getting Started","text":"<p>This guide will help you set up Tomato and run your first behavioral test.</p>"},{"location":"getting-started/#prerequisites","title":"Prerequisites","text":"<ul> <li>Go 1.21+ (for installation)</li> <li>Docker (for running containers)</li> </ul>"},{"location":"getting-started/#installation","title":"Installation","text":""},{"location":"getting-started/#quick-install-recommended","title":"Quick Install (Recommended)","text":"<pre><code>curl -fsSL https://raw.githubusercontent.com/tomatool/tomato/main/install.sh | sh\n</code></pre>"},{"location":"getting-started/#using-go","title":"Using Go","text":"<pre><code>go install github.com/tomatool/tomato@latest\n</code></pre>"},{"location":"getting-started/#using-homebrew","title":"Using Homebrew","text":"<pre><code>brew install tomatool/tap/tomato\n</code></pre>"},{"location":"getting-started/#verify-installation","title":"Verify Installation","text":"<pre><code>tomato --version\n</code></pre>"},{"location":"getting-started/#initialize-a-project","title":"Initialize a Project","text":"<p>Create a new project with the init command:</p> <pre><code>mkdir my-project &amp;&amp; cd my-project\ntomato init\n</code></pre> <p>This creates: - <code>tomato.yml</code> - Main configuration file - <code>features/</code> - Directory for your feature files</p>"},{"location":"getting-started/#project-structure","title":"Project Structure","text":"<pre><code>my-project/\n\u251c\u2500\u2500 tomato.yml           # Main configuration\n\u251c\u2500\u2500 features/\n\u2502   \u2514\u2500\u2500 example.feature  # Gherkin test files\n\u2514\u2500\u2500 fixtures/            # Optional: SQL scripts, test data\n</code></pre>"},{"location":"getting-started/#configuration","title":"Configuration","text":"<p>Edit <code>tomato.yml</code> to define your test environment:</p> <pre><code>version: 2\n\n# Test settings\nsettings:\n  timeout: 5m\n  fail_fast: true\n  reset:\n    level: scenario  # Reset resources between scenarios\n\n# Define containers to run\ncontainers:\n  postgres:\n    image: postgres:15\n    env:\n      POSTGRES_USER: test\n      POSTGRES_PASSWORD: test\n      POSTGRES_DB: test\n    wait_for:\n      type: port\n      target: \"5432\"\n\n  redis:\n    image: redis:7\n    wait_for:\n      type: port\n      target: \"6379\"\n\n# Define resources (handlers) for your tests\nresources:\n  db:\n    type: postgres\n    container: postgres\n    database: test\n\n  cache:\n    type: redis\n    container: redis\n\n  api:\n    type: http\n    base_url: http://localhost:8080\n\n# Feature file locations\nfeatures:\n  paths:\n    - ./features\n  tags: \"@smoke\"  # Optional: filter by tags\n</code></pre>"},{"location":"getting-started/#writing-tests","title":"Writing Tests","text":"<p>Create a feature file in <code>features/</code>:</p> <pre><code># features/user_api.feature\nFeature: User API\n\n  Background:\n    Given I set \"db\" table \"users\" with values:\n      | id | name  | email          |\n      | 1  | Alice | alice@test.com |\n\n  Scenario: Get user by ID\n    When I send \"GET\" request to \"api\" \"/users/1\"\n    Then \"api\" response status should be \"200\"\n    And \"api\" response JSON \"name\" should be \"Alice\"\n\n  Scenario: Create new user\n    When I set \"api\" JSON body:\n      \"\"\"\n      {\"name\": \"Bob\", \"email\": \"bob@test.com\"}\n      \"\"\"\n    And I send \"POST\" request to \"api\" \"/users\"\n    Then \"api\" response status should be \"201\"\n    And \"db\" table \"users\" should have \"2\" rows\n</code></pre>"},{"location":"getting-started/#running-tests","title":"Running Tests","text":"<p>Run all tests:</p> <pre><code>tomato run\n</code></pre> <p>Run with specific tags:</p> <pre><code>tomato run --tags \"@smoke\"\n</code></pre> <p>Run with verbose output:</p> <pre><code>tomato run -v\n</code></pre>"},{"location":"getting-started/#testing-your-application","title":"Testing Your Application","text":"<p>Tomato can also start your application and connect it to test containers:</p> <pre><code># tomato.yml\napp:\n  command: go run ./cmd/server\n  port: 8080\n  ready:\n    type: http\n    path: /health\n  wait: 5s\n  env:\n    DATABASE_URL: \"postgres://test:test@{{.postgres.host}}:{{.postgres.port}}/test\"\n    REDIS_URL: \"redis://{{.redis.host}}:{{.redis.port}}\"\n</code></pre> <p>The <code>{{.container.host}}</code> and <code>{{.container.port}}</code> templates are replaced with actual container addresses.</p>"},{"location":"getting-started/#next-steps","title":"Next Steps","text":"<ul> <li>Configuration Reference - Full configuration options</li> <li>Resources - All available step definitions</li> <li>Examples - Sample projects</li> </ul>"},{"location":"resources/","title":"Available Resources","text":"<p>Tomato supports the following resource types for behavioral testing.</p> Resource Type Description HTTP Client <code>http</code> Steps for making HTTP requests and validating responses HTTP Server <code>http-server</code> Steps for stubbing HTTP services PostgreSQL <code>postgres</code> Steps for interacting with PostgreSQL databases Redis <code>redis</code> Steps for interacting with Redis key-value store Kafka <code>kafka</code> Steps for interacting with Apache Kafka message broker Shell <code>shell</code> Steps for executing shell commands and scripts WebSocket Client <code>websocket</code> Steps for connecting to WebSocket servers WebSocket Server <code>websocket-server</code> Steps for stubbing WebSocket services"},{"location":"resources/#variables-and-dynamic-values","title":"Variables and Dynamic Values","text":"<p>Tomato supports variables that can be used in URLs, headers, and request bodies. Variables use the <code>{{name}}</code> syntax.</p>"},{"location":"resources/#dynamic-value-generation","title":"Dynamic Value Generation","text":"<p>Built-in functions generate unique values on each use:</p> Function Example Output Description <code>{{uuid}}</code> <code>f47ac10b-58cc-4372-a567-0e02b2c3d479</code> Random UUID v4 <code>{{timestamp}}</code> <code>2024-01-15T10:30:00Z</code> Current ISO 8601 timestamp <code>{{timestamp:unix}}</code> <code>1705315800</code> Unix timestamp in seconds <code>{{random:N}}</code> <code>A8kL2mN9pQ</code> Random alphanumeric string of length N <code>{{random:N:numeric}}</code> <code>8472910384</code> Random numeric string of length N <code>{{sequence:name}}</code> <code>1</code>, <code>2</code>, <code>3</code>... Auto-incrementing sequence by name <p>Example: <pre><code>When \"api\" sends \"POST\" to \"/api/users\" with json:\n  \"\"\"\n  {\n    \"id\": \"{{uuid}}\",\n    \"username\": \"user_{{random:8}}\",\n    \"created_at\": \"{{timestamp}}\"\n  }\n  \"\"\"\n</code></pre></p>"},{"location":"resources/#capturing-response-values","title":"Capturing Response Values","text":"<p>Save values from responses to use in subsequent requests:</p> Step Description <code>\"api\" response json \"path\" saved as \"{{var}}\"</code> Save JSON path value to variable <code>\"api\" response header \"Name\" saved as \"{{var}}\"</code> Save response header to variable <p>Example - CRUD workflow: <pre><code>Scenario: Create and retrieve a user\n  # Create user and capture the ID\n  When \"api\" sends \"POST\" to \"/api/users\" with json:\n    \"\"\"\n    { \"name\": \"Alice\" }\n    \"\"\"\n  Then \"api\" response status is \"201\"\n  And \"api\" response json \"id\" saved as \"{{user_id}}\"\n\n  # Use captured ID in subsequent request\n  When \"api\" sends \"GET\" to \"/api/users/{{user_id}}\"\n  Then \"api\" response status is \"200\"\n  And \"api\" response json \"name\" is \"Alice\"\n\n  # Delete the user\n  When \"api\" sends \"DELETE\" to \"/api/users/{{user_id}}\"\n  Then \"api\" response status is \"204\"\n</code></pre></p> <p>Variables and sequences are automatically reset between scenarios.</p>"},{"location":"resources/#json-matchers","title":"JSON Matchers","text":"<p>When using <code>response json matches:</code> or <code>response json contains:</code>, you can use these matchers:</p>"},{"location":"resources/#type-matchers","title":"Type Matchers","text":"Matcher Description <code>@string</code> Matches any string value <code>@number</code> Matches any numeric value <code>@boolean</code> Matches true or false <code>@array</code> Matches any array <code>@object</code> Matches any object <code>@null</code> Matches null <code>@notnull</code> Matches any non-null value <code>@any</code> Matches any value <code>@empty</code> Matches empty string, array, or object <code>@notempty</code> Matches non-empty string, array, or object"},{"location":"resources/#string-matchers","title":"String Matchers","text":"Matcher Description <code>@regex:pattern</code> Matches string against regex pattern <code>@contains:text</code> Matches if string contains text <code>@startswith:text</code> Matches if string starts with text <code>@endswith:text</code> Matches if string ends with text"},{"location":"resources/#numeric-matchers","title":"Numeric Matchers","text":"Matcher Description <code>@gt:n</code> Matches if value &gt; n <code>@gte:n</code> Matches if value &gt;= n <code>@lt:n</code> Matches if value &lt; n <code>@lte:n</code> Matches if value &lt;= n"},{"location":"resources/#length-matcher","title":"Length Matcher","text":"Matcher Description <code>@len:n</code> Matches if length equals n (for strings, arrays, objects)"},{"location":"resources/#example","title":"Example","text":"<pre><code>Then \"api\" response json contains:\n  \"\"\"\n  {\n    \"id\": \"@regex:^[0-9a-f-]{36}$\",\n    \"name\": \"@notempty\",\n    \"email\": \"@contains:@\",\n    \"age\": \"@gt:0\",\n    \"tags\": \"@array\"\n  }\n  \"\"\"\n</code></pre>"},{"location":"resources/http-client/","title":"HTTP Client","text":"<p>Steps for making HTTP requests and validating responses</p>"},{"location":"resources/http-client/#request-setup","title":"Request Setup","text":"Step Description <code>\"api\" header \"Content-Type\" is \"application/json\"</code> Set a header <code>\"api\" headers are:</code> Set multiple headers from table <code>\"api\" query param \"page\" is \"1\"</code> Set a query parameter <code>\"api\" body is:</code> Set raw request body (docstring) <code>\"api\" json body is:</code> Set JSON body + Content-Type header <code>\"api\" form body is:</code> Set form-encoded body from table"},{"location":"resources/http-client/#request-execution","title":"Request Execution","text":"Step Description <code>\"api\" sends \"GET\" to \"/users\"</code> Send HTTP request <code>\"api\" sends \"POST\" to \"/users\" with body:</code> Send with raw body <code>\"api\" sends \"POST\" to \"/users\" with json:</code> Send with JSON body"},{"location":"resources/http-client/#response-status","title":"Response Status","text":"Step Description <code>\"api\" response status is \"200\"</code> Assert exact status code <code>\"api\" response status is success</code> Assert status class (2xx, 3xx, 4xx, 5xx)"},{"location":"resources/http-client/#response-headers","title":"Response Headers","text":"Step Description <code>\"api\" response header \"Content-Type\" is \"application/json\"</code> Assert exact header value <code>\"api\" response header \"Content-Type\" contains \"json\"</code> Assert header contains substring <code>\"api\" response header \"X-Request-Id\" exists</code> Assert header exists"},{"location":"resources/http-client/#response-body","title":"Response Body","text":"Step Description <code>\"api\" response body is:</code> Assert exact body match <code>\"api\" response body contains \"success\"</code> Assert body contains substring <code>\"api\" response body does not contain \"error\"</code> Assert body doesn't contain substring <code>\"api\" response body is empty</code> Assert empty body"},{"location":"resources/http-client/#response-json","title":"Response JSON","text":"Step Description <code>\"api\" response json \"data.id\" is \"123\"</code> Assert JSON path value <code>\"api\" response json \"data.id\" exists</code> Assert JSON path exists <code>\"api\" response json \"data.deleted\" does not exist</code> Assert JSON path doesn't exist <code>\"api\" response json matches:</code> Assert exact JSON structure with matchers: @string, @number, @boolean, @array, @object, @any, @null, @notnull, @empty, @notempty, @regex:pattern, @contains:text, @startswith:text, @endswith:text, @gt:n, @gte:n, @lt:n, @lte:n, @len:n <code>\"api\" response json contains:</code> Assert JSON contains specified fields (ignores extra fields). Supports same matchers as 'matches' <code>\"api\" response json \"id\" matches pattern \"^[0-9a-f-]{36}$\"</code> Assert JSON path value matches regex pattern <code>\"api\" response json \"id\" is uuid</code> Assert JSON path value is a valid UUID <code>\"api\" response json \"email\" is email</code> Assert JSON path value is a valid email format <code>\"api\" response json \"created_at\" is iso-timestamp</code> Assert JSON path value is an ISO 8601 timestamp"},{"location":"resources/http-client/#response-timing","title":"Response Timing","text":"Step Description <code>\"api\" response time is less than \"500ms\"</code> Assert response time"},{"location":"resources/http-client/#variable-capture","title":"Variable Capture","text":"Step Description <code>\"api\" response json \"id\" saved as \"{{user_id}}\"</code> Save JSON path value to variable for use in subsequent requests <code>\"api\" response header \"Location\" saved as \"{{location}}\"</code> Save response header value to variable"},{"location":"resources/http-server/","title":"HTTP Server","text":"<p>Steps for stubbing HTTP services</p>"},{"location":"resources/http-server/#stub-setup","title":"Stub Setup","text":"Step Description <code>\"{resource}\" stub \"GET\" \"/users\" returns \"200\"</code> Creates a stub that returns a status code `\"{resource}\" stub \"GET\" \"/users\" returns \"200\" with body: \"\"\" [{\"id\": 1}] \"\"\"` Creates a stub that returns a status code and body `\"{resource}\" stub \"GET\" \"/users\" returns \"200\" with json: \"\"\" [{\"id\": 1}] \"\"\"` Creates a stub that returns JSON (auto sets Content-Type) `\"{resource}\" stub \"GET\" \"/users\" returns \"200\" with headers: header value X-Custom value"},{"location":"resources/http-server/#verification","title":"Verification","text":"Step Description <code>\"{resource}\" received \"GET\" \"/users\"</code> Asserts a request was received <code>\"{resource}\" received \"GET\" \"/users\" \"2\" times</code> Asserts a request was received N times <code>\"{resource}\" did not receive \"DELETE\" \"/users\"</code> Asserts a request was not received <code>\"{resource}\" received request with header \"Authorization\" containing \"Bearer\"</code> Asserts any request was received with header containing value <code>\"{resource}\" received request with body containing \"name\"</code> Asserts any request was received with body containing value <code>\"{resource}\" received \"5\" requests</code> Asserts total number of requests received"},{"location":"resources/http-server/#server-info","title":"Server Info","text":"Step Description <code>\"{resource}\" url is stored in \"SERVER_URL\"</code> Stores the server URL in a variable for use in other steps"},{"location":"resources/kafka/","title":"Kafka","text":"<p>Steps for interacting with Apache Kafka message broker</p>"},{"location":"resources/kafka/#topic-management","title":"Topic Management","text":"Step Description <code>\"{resource}\" topic \"events\" exists</code> Asserts a Kafka topic exists <code>\"{resource}\" creates topic \"events\"</code> Creates a Kafka topic with 1 partition <code>\"{resource}\" creates topic \"events\" with \"3\" partitions</code> Creates a Kafka topic with specified partitions"},{"location":"resources/kafka/#publishing","title":"Publishing","text":"Step Description `\"{resource}\" publishes to \"events\": \"\"\" Hello World \"\"\"` Publishes a message to a topic `\"{resource}\" publishes to \"events\" with key \"user-123\": \"\"\" Hello World \"\"\"` Publishes a message with a key to a topic `\"{resource}\" publishes json to \"events\": \"\"\" {\"type\": \"user_created\"} \"\"\"` Publishes a JSON message to a topic `\"{resource}\" publishes json to \"events\" with key \"user-123\": \"\"\" {\"type\": \"user_created\"} \"\"\"` Publishes a JSON message with a key `\"{resource}\" publishes messages to \"events\": key value user-1 {\"id\": 1}"},{"location":"resources/kafka/#consuming","title":"Consuming","text":"Step Description <code>\"{resource}\" consumes from \"events\"</code> Starts consuming messages from a topic <code>\"{resource}\" receives from \"events\" within \"5s\"</code> Waits for a message from a topic within timeout `\"{resource}\" receives from \"events\" within \"5s\": \"\"\" Hello World \"\"\"` Asserts a specific message is received within timeout <code>\"{resource}\" receives from \"events\" with key \"user-123\" within \"5s\"</code> Asserts a message with specific key is received"},{"location":"resources/kafka/#assertions","title":"Assertions","text":"Step Description <code>\"{resource}\" topic \"events\" has \"3\" messages</code> Asserts topic has exactly N messages consumed <code>\"{resource}\" topic \"events\" is empty</code> Asserts no messages have been consumed from topic `\"{resource}\" last message contains: \"\"\" user_created \"\"\"` Asserts the last consumed message contains content <code>\"{resource}\" last message has key \"user-123\"</code> Asserts the last consumed message has specific key <code>\"{resource}\" last message has header \"content-type\" with value \"application/json\"</code> Asserts the last message has a header with value `\"{resource}\" receives messages from \"events\" in order: key value key1 msg1"},{"location":"resources/postgres/","title":"PostgreSQL","text":"<p>Steps for interacting with PostgreSQL databases</p>"},{"location":"resources/postgres/#data-setup","title":"Data Setup","text":"Step Description <code>\"db\" table \"users\" has values:</code> Insert rows from table <code>\"db\" clears table \"users\"</code> Truncate a table (removes all rows) <code>\"db\" clears tables:</code> Truncate multiple tables from list <code>\"db\" executes:</code> Execute raw SQL <code>\"db\" executes file \"fixtures/seed.sql\"</code> Execute SQL from file"},{"location":"resources/postgres/#assertions","title":"Assertions","text":"Step Description <code>\"db\" table \"users\" contains:</code> Assert table contains rows <code>\"db\" table \"users\" is empty</code> Assert table is empty <code>\"db\" table \"users\" has \"5\" rows</code> Assert row count"},{"location":"resources/redis/","title":"Redis","text":"<p>Steps for interacting with Redis key-value store</p>"},{"location":"resources/redis/#string-operations","title":"String Operations","text":"Step Description <code>\"cache\" key \"user:1\" is \"John\"</code> Set a string value <code>\"cache\" key \"session:abc\" is \"data\" with TTL \"1h\"</code> Set a string value with expiration <code>\"cache\" key \"user:1\" is:</code> Set a JSON/multiline value <code>\"cache\" key \"user:1\" is deleted</code> Delete a key <code>\"cache\" key \"counter\" is incremented</code> Increment integer value by 1 <code>\"cache\" key \"counter\" is incremented by \"5\"</code> Increment integer value by N <code>\"cache\" key \"counter\" is decremented</code> Decrement integer value by 1"},{"location":"resources/redis/#string-assertions","title":"String Assertions","text":"Step Description <code>\"cache\" key \"user:1\" exists</code> Assert key exists <code>\"cache\" key \"user:1\" does not exist</code> Assert key doesn't exist <code>\"cache\" key \"user:1\" has value \"John\"</code> Assert exact value <code>\"cache\" key \"user:1\" contains \"John\"</code> Assert value contains substring <code>\"cache\" key \"session:abc\" has TTL greater than \"3600\" seconds</code> Assert TTL greater than N seconds"},{"location":"resources/redis/#hash-operations","title":"Hash Operations","text":"Step Description <code>\"cache\" hash \"user:1\" has fields:</code> Set hash fields from table <code>\"cache\" hash \"user:1\" field \"name\" is \"John\"</code> Assert hash field value <code>\"cache\" hash \"user:1\" contains:</code> Assert hash contains fields"},{"location":"resources/redis/#list-operations","title":"List Operations","text":"Step Description <code>\"cache\" list \"queue\" has \"item1\"</code> Push value to list <code>\"cache\" list \"queue\" has values:</code> Push multiple values to list <code>\"cache\" list \"queue\" has \"3\" items</code> Assert list length <code>\"cache\" list \"queue\" contains \"item1\"</code> Assert list contains value"},{"location":"resources/redis/#set-operations","title":"Set Operations","text":"Step Description <code>\"cache\" set \"tags\" has \"tag1\"</code> Add member to set <code>\"cache\" set \"tags\" has members:</code> Add multiple members to set <code>\"cache\" set \"tags\" contains \"tag1\"</code> Assert set contains member <code>\"cache\" set \"tags\" has \"3\" members</code> Assert set size"},{"location":"resources/redis/#database","title":"Database","text":"Step Description <code>\"cache\" has \"5\" keys</code> Assert total key count <code>\"cache\" is empty</code> Assert database is empty"},{"location":"resources/shell/","title":"Shell","text":"<p>Steps for executing shell commands and scripts</p>"},{"location":"resources/shell/#setup","title":"Setup","text":"Step Description <code>\"shell\" env \"API_KEY\" is \"secret\"</code> Set environment variable <code>\"shell\" workdir is \"/tmp/test\"</code> Set working directory"},{"location":"resources/shell/#execution","title":"Execution","text":"Step Description <code>\"shell\" runs:</code> Run command (docstring) <code>\"shell\" runs \"ls -la\"</code> Run inline command <code>\"shell\" runs script \"scripts/setup.sh\"</code> Run script file <code>\"shell\" runs with timeout \"60s\":</code> Run with custom timeout"},{"location":"resources/shell/#exit-code","title":"Exit Code","text":"Step Description <code>\"shell\" exit code is \"0\"</code> Assert exit code <code>\"shell\" succeeds</code> Assert exit code 0 <code>\"shell\" fails</code> Assert non-zero exit code"},{"location":"resources/shell/#output","title":"Output","text":"Step Description <code>\"shell\" stdout contains \"success\"</code> Assert stdout contains substring <code>\"shell\" stdout does not contain \"error\"</code> Assert stdout doesn't contain <code>\"shell\" stdout is:</code> Assert exact stdout <code>\"shell\" stdout is empty</code> Assert stdout empty <code>\"shell\" stderr contains \"warning\"</code> Assert stderr contains substring <code>\"shell\" stderr is empty</code> Assert stderr empty"},{"location":"resources/shell/#files","title":"Files","text":"Step Description <code>\"shell\" file \"output.txt\" exists</code> Assert file exists <code>\"shell\" file \"temp.txt\" does not exist</code> Assert file doesn't exist <code>\"shell\" file \"config.json\" contains \"database\"</code> Assert file contains substring"},{"location":"resources/websocket-client/","title":"WebSocket Client","text":"<p>Steps for connecting to WebSocket servers</p>"},{"location":"resources/websocket-client/#connection","title":"Connection","text":"Step Description <code>\"ws\" connects</code> Connect to WebSocket endpoint <code>\"ws\" connects with headers:</code> Connect with custom headers <code>\"ws\" disconnects</code> Disconnect from WebSocket <code>\"ws\" is connected</code> Assert connected <code>\"ws\" is disconnected</code> Assert disconnected"},{"location":"resources/websocket-client/#sending","title":"Sending","text":"Step Description <code>\"ws\" sends:</code> Send text message (docstring) <code>\"ws\" sends \"ping\"</code> Send short text message <code>\"ws\" sends json:</code> Send JSON message"},{"location":"resources/websocket-client/#receiving","title":"Receiving","text":"Step Description <code>\"ws\" receives within \"5s\":</code> Assert message received within timeout <code>\"ws\" receives within \"5s\" containing \"success\"</code> Assert message containing substring received <code>\"ws\" receives json within \"5s\" matching:</code> Assert JSON message matching structure <code>\"ws\" receives \"3\" messages within \"10s\"</code> Assert N messages received within timeout <code>\"ws\" does not receive within \"2s\"</code> Assert no message received"},{"location":"resources/websocket-client/#assertions","title":"Assertions","text":"Step Description <code>\"ws\" last message is:</code> Assert last message matches exactly <code>\"ws\" last message contains \"success\"</code> Assert last message contains substring <code>\"ws\" last message is json matching:</code> Assert last message is JSON matching structure <code>\"ws\" received \"5\" messages</code> Assert total message count"},{"location":"resources/websocket-server/","title":"WebSocket Server","text":"<p>Steps for stubbing WebSocket services</p>"},{"location":"resources/websocket-server/#setup","title":"Setup","text":"Step Description `\"{resource}\" on connect sends: \"\"\" {\"type\": \"welcome\"} \"\"\"` Sends a message when a client connects `\"{resource}\" on message \"ping\" replies: \"\"\" pong \"\"\"` Replies to an exact message `\"{resource}\" on message matching \".subscribe.\" replies: \"\"\" {\"status\": \"subscribed\"} \"\"\"` Replies to messages matching a regex pattern"},{"location":"resources/websocket-server/#broadcast","title":"Broadcast","text":"Step Description `\"{resource}\" broadcasts: \"\"\" {\"event\": \"update\"} \"\"\"` Broadcasts a message to all connected clients <code>\"{resource}\" broadcasts \"ping\"</code> Broadcasts a short message to all connected clients"},{"location":"resources/websocket-server/#assertions","title":"Assertions","text":"Step Description <code>\"{resource}\" has \"2\" connections</code> Asserts the number of connected clients <code>\"{resource}\" received message \"ping\"</code> Asserts a specific message was received <code>\"{resource}\" received \"3\" messages</code> Asserts the total number of messages received"}]}